<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/avatar.jpg"/><link rel="stylesheet" href="/_next/static/css/f194b09a73f2e100.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-97a4f47456697fca.js"/><script src="/_next/static/chunks/4bd1b696-4042c1d6d7e15b27.js" async=""></script><script src="/_next/static/chunks/1517-4ce464ed9da3a640.js" async=""></script><script src="/_next/static/chunks/main-app-59d47cb7e6ea11f6.js" async=""></script><script src="/_next/static/chunks/4bd22374-385178446340ab50.js" async=""></script><script src="/_next/static/chunks/8173-a0231b583aa8a812.js" async=""></script><script src="/_next/static/chunks/8541-8e89d807b2dd16b4.js" async=""></script><script src="/_next/static/chunks/5699-d5e6aa1c7bb352a9.js" async=""></script><script src="/_next/static/chunks/app/cyber/blog/vb-password-bypass/page-0502d12e5cab0255.js" async=""></script><link rel="icon" href="/avatar.jpg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="Wrapper"><div><div class="burger-menu">☰ <!-- -->            </div><div class="sidebarLeft "><div class="avatar"><img src="/avatar.jpg" alt="Avatar"/></div><ul><a href="/"><li>Search</li></a><a href="/cyber/writeup"><li>Writeups</li></a><a href="/cyber/blog"><li>Blog</li></a><a href="/cyber/tags"><li>Tags</li></a><a href=""><li style="color:#555555">Resources</li></a><a href="/cyber/cheat-sheet"><li>Cheat sheets</li></a></ul></div></div><div class="content"><div class="Post"><div><div id="Run-and-Debug-DLL"><div><h1><span style="color:#da1953">Byp</span>ass Visual Basic password protected source code</h1><hr></div><div id="banner"><div><img src="/cyber/blog/vbpasswordbypass/banner.webp" alt=""></div></div><div id="Introduction"><div><hr><h2><span style="color:#da1953">Int</span>roduction</h2></div><div><p>During one of my penetration tests, I was presented with a Visual Basic application to test. This VB application was part of an Excel sheet. After some basic testing, I dug into it a little bit more and found out that the authentication panel could be bypassed. After some research, I was able to bypass it, access the source code, and modify it. Here I am presenting a demo with a Hello Word project to avoid disclosing client's sensitive information.</p></div><div><p>The objective is to create 2 VB applications. The first one acts as a target to bypass with the password set as "test" (unknown to us), the second one set with a password known to us "jafor", then replacing the known password inside the target file to access the source code with the known password ("jafor")</p></div></div><div id="Create-Hello-Word-Project"><div><h2><span style="color:#da1953">Cre</span>ate Hello Word Project</h2></div><div id="Enable-Developer-Tab-in-Excel"><div><h3>Enable Developer Tab in Excel</h3></div><div><p>In order to create a visual basic project, you must first enable the developer tab to access the editor. To enable the developer tab you need to go to File → Options → Customize ribbons. Once the Excel Options window is open, enable developer mode and click &quot;OK&quot;.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/1b36eb565bf04e759f9399d43dee5d31.png"></p></div><div><p>Now you can access macros and write code in Visual Basic.</p></div></div><div id="Write-source-code"><div><h3>Write source code</h3></div><div><p>To access the code editor from the Developer tab, click Visual Basic.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/8865d3c2b8a744f6a57ffe435041d632.png"></p></div><div><p>At this point you will find yourself in front of your editor ready to write the code.</p></div><div><img src="/cyber/blog/vbpasswordbypass/31350674d7ef40e693fae6fb97f708e3.png"></p></div><div><p>The code with which I tested the project is the following:</p></div><div><p><pre class="code-vb"><span class="keyword">Sub</span> TestProtection()<br><span class="function">Range</span>(<span class="string">"A1"</span>).<span class="function">Value</span> = <span class="string">"Hello World"</span><br><span class="function">Range</span>(<span class="string">"B1"</span>).<span class="function">Value</span> = <span class="function">Int</span>((10 * <span class="function">Rnd</span>) + 1)<br><span class="keyword">End</span> <span class="keyword">Sub</span><br></pre></p></div></div><div id="Set-Password-Protection"><div><h3>Set Password Protection</h3></div><div><p>To set the password go to Tools → VBAProject Properties → Protection Tab Set the password as you like and remember to enable &quot;Lock project for viewing&quot;. This option prevents the code from being displayed.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/9d625bae970940b48d5298e6c4e2221a.png"></p></div><div><p><img src="/cyber/blog/vbpasswordbypass/64aa7bd0a02343ceb079f66d6fc9cae5.png"></p></div><div><p>In this file, the password set is &quot;test&quot;.</p></div></div><div id="Save-file"><div><h3>Save file</h3></div><div><p>To save the project click on &quot;Save&quot; and choose &quot;No&quot;.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/a43a6fa18bc248e2a21bc64a785f86aa.png"></p></div><div><p>In the new window that will be presented, change the format of the file to be saved to &quot;Excel Macro-Enabled Workbook&quot; and save it.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/6a20d818fca248beac72abe99e9c7b60.png"></p></div><div><p>It will generate a new file containing the source code.</p></div></div><div id="Test-Password-Protection"><div><h3>Test Password Protection</h3></div><div><p>To test the password protection open the new file and access the source code, the shorcut is alt+F11 but for some reason is not working for me. Another way to access is navigating to Developer tab and access VisualBasic.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/efa4d62102ca42959f3b55845fb5b77d.png"></p></div><div><p>Trying to access the project containing the source code, you will be asked to enter the previously set password.</p></div><div><img src="/cyber/blog/vbpasswordbypass/d2b595d50c3a49d98d25b5d4f3710e06.png"></p></div></div></div><div id="Replace-password-protection"><div><h2><span style="color:#da1953">Rep</span>lace password protection</h2></div><div id="Create-a-dummy-project"><div><h3>Create a dummy project</h3></div><div><p>In order to access the password-protected source code, we need to create a dummy project with our password and replace the binary dedicated to checking the password on the target file with our own. In words, it might seem difficult but with the example, I am about to show it will be very simple.  Now let's recreate the second file in the same way as seen above but with a different password, let's say that this time the password will be &quot;jafor&quot;. So we have 2 files one with a password set to &quot;test&quot; which is the target file in which we have to bypass the password and the second is our file with a password set to &quot;jafor&quot;. The goal is to replace the password &quot;test&quot; of the first file with the password &quot;jafor&quot;.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/11b19e8cf2624d2f8c16b9134396e097.png"></p></div></div><div id="Exctrat-jafor&#x27;s-authentication-hex-code"><div><h3>Exctrat jafor's authentication hex code</h3></div><div><p>To extract the code you need to change the file format from <em>.xlsm</em> to <em>.zip</em>.<p></div><div><img src="/cyber/blog/vbpasswordbypass/fa3bb4f12a974f5a8a80b4992948b541.png"></p></div><div><p>When opening the zip file you will find a folder structure like the following:</p></div><div><img src="/cyber/blog/vbpasswordbypass/cd3dc0fb138e4ccda1c12cef78d7ca41.png"></p></div><div><p>Navigate into the <strong>xl</strong> directory and open <strong>vbaProject.bin</strong> with a hex editor.</p></div><div><img src="/cyber/blog/vbpasswordbypass/735041c734354f049bbf9fc0c079d365.png"></p></div><div><p>The hex-editor used is <a data-from-md title='https://mh-nexus.de/en/hxd/' href='https://mh-nexus.de/en/hxd/'>xhd</a>. Once opened the <em>filevbaProject .bin</em> with the hex-editor, search for the text <em>CMG</em> as seen in the image below.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/c7981a94ce9e4d49bfca963c1c740516.png"></p></div><div><p>Now copy the portion as shown below.</p></div><div><img src="/cyber/blog/vbpasswordbypass/c893006ae98e43f4a07e554a972f4d2f.png"></p></div><div><p>This is the portion of code where it says which password is set, which in this case is &quot;jafor&quot;. Our goal is to replace this portion in the target file so that the password set is &quot;jafor&quot; and no longer &quot;test&quot;.</p></div></div><div id="Replace-password-in-the-target-file"><div><h3>Replace password in the target file</h3></div><div><p>We also perform the same steps on the target file to open the binary file with our hex editor and paste the dummy's code in the target file and save it.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/7e876409db514302bd184792b83f7d46.png"></p></div><div><p>After changing the target file's code with our dummy's code:</p></div><div><img src="/cyber/blog/vbpasswordbypass/a6195e41074b484da3625961a1b1e8d7.png"></p></div><div><p>Replace the modified binary with the original one inside the zip folder and change the format back from <em>.zip</em> to <em>.xlsm</em>. Now we can access the source code with the password &quot;jafor&quot; instead of &quot;test&quot;.</p></div><div><p><img src="/cyber/blog/vbpasswordbypass/a433c13f02d6453ab41d6a49f87d78d1.png"></p></div></div></div></div> </div></div></div><div class="sidebarRight"><div class="sidebarRightChild"><h2>Index</h2><div></div><br/><h2>Tags</h2><div class="tags"><a style="margin-top:10px" href="/cyber/tags?searchTag=application"><my-tag>application</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=bypass"><my-tag>bypass</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=hex"><my-tag>hex</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=login+panel"><my-tag>login panel</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=reverse+engineering"><my-tag>reverse engineering</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=security"><my-tag>security</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=visual+basic"><my-tag>visual basic</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=windows"><my-tag>windows</my-tag></a></div></div></div></div><script src="/_next/static/chunks/webpack-97a4f47456697fca.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n4:I[3108,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-8e89d807b2dd16b4.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"919\",\"static/chunks/app/cyber/blog/vb-password-bypass/page-0502d12e5cab0255.js\"],\"default\"]\n5:I[5897,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-8e89d807b2dd16b4.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"919\",\"static/chunks/app/cyber/blog/vb-password-bypass/page-0502d12e5cab0255.js\"],\"default\"]\n6:I[8845,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-8e89d807b2dd16b4.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"919\",\"static/chunks/app/cyber/blog/vb-password-bypass/page-0502d12e5cab0255.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/css/f194b09a73f2e100.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"R8BAXJwLMFiNLE5_DJVMX\",\"p\":\"\",\"c\":[\"\",\"cyber\",\"blog\",\"vb-password-bypass\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"cyber\",{\"children\":[\"blog\",{\"children\":[\"vb-password-bypass\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[\"$\",\"div\",null,{\"children\":[\"$\",\"center\",null,{\"children\":[\"Page not found\",[\"$\",\"br\",null,{}],\"You have followed and old link that does not work anymore\",[\"$\",\"br\",null,{}],\"The site has migrated from React app to NextJS app\"]}]}]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"cyber\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"vb-password-bypass\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"blog\",\"children\",\"vb-password-bypass\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"Wrapper\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"div\",null,{\"className\":\"content\",\"children\":[\"$\",\"div\",null,{\"className\":\"Post\",\"children\":[\"$\",\"$L5\",null,{\"postname\":\"blogdb/vb-password-bypass.json\"}]}]}],[\"$\",\"$L6\",null,{\"postname\":\"blogdb/vb-password-bypass.json\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f194b09a73f2e100.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"vlsleM361VujaExx_hwKQ\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"1\",{\"rel\":\"icon\",\"href\":\"/avatar.jpg\"}]]\n"])</script><script>self.__next_f.push([1,"8:null\n"])</script></body></html>