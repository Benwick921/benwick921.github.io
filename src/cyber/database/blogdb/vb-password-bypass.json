{
    "note":"title must match route name in App.js",
    "title":"Bypass Visual Basic password protected source code",
    "tags":["security", "reverse engineering", "windows", "visual basic", "login panel", "bypass", "hex", "application"],
    "date":"11/08/2024",
    "path":"vb-password-bypass",
    "location": "./blog/",
    "banner":"blog/vbpasswordbypass/banner.webp",
    "type":"blog",
    "search":[
        {
            "section":"Replace password protection",
            "description":"Replacing Visual Basic (VB) password hex code with a known password to bypass the login panel and accssin the source code"
        }
    ],
    "body":[
        {
            "id":"Run and Debug DLL",
            "title":"<h1><span style=\"color:#da1953\">Byp</span>ass Visual Basic password protected source code</h1><hr>",
            "body":[
                {
                    "id":"banner",
                    "title":"",
                    "body":[
                        "<img src=\"/cyber/blog/vbpasswordbypass/banner.webp\" alt=\"\">"
                    ]
                },
                {
                    "id":"Introduction",
                    "title":"<hr><h2><span style=\"color:#da1953\">Int</span>roduction</h2>",
                    "body":[
                        "<p>During one of my penetration tests, I was presented with a Visual Basic application to test. This VB application was part of an Excel sheet. After some basic testing, I dug into it a little bit more and found out that the authentication panel could be bypassed. After some research, I was able to bypass it, access the source code, and modify it. Here I am presenting a demo with a Hello Word project to avoid disclosing client's sensitive information.</p>",
                        "<p>The objective is to create 2 VB applications. The first one acts as a target to bypass with the password set as \"test\" (unknown to us), the second one set with a password known to us \"jafor\", then replacing the known password inside the target file to access the source code with the known password (\"jafor\")</p>"
                    ]
                },
                {
                    "id":"Create Hello Word Project",
                    "title":"<h2><span style=\"color:#da1953\">Cre</span>ate Hello Word Project</h2>",
                    "body":[
                        {
                            "id":"Enable Developer Tab in Excel",
                            "title":"<h3>Enable Developer Tab in Excel</h3>",
                            "body":[
                                "<p>In order to create a visual basic project, you must first enable the developer tab to access the editor. To enable the developer tab you need to go to File → Options → Customize ribbons. Once the Excel Options window is open, enable developer mode and click &quot;OK&quot;.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/1b36eb565bf04e759f9399d43dee5d31.png\"></p>",
                                "<p>Now you can access macros and write code in Visual Basic.</p>"
                            ]
                        },
                        {
                            "id":"Write source code",
                            "title":"<h3>Write source code</h3>",
                            "body":[
                                "<p>To access the code editor from the Developer tab, click Visual Basic.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/8865d3c2b8a744f6a57ffe435041d632.png\"></p>",
                                "<p>At this point you will find yourself in front of your editor ready to write the code.</p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/31350674d7ef40e693fae6fb97f708e3.png\"></p>",
                                "<p>The code with which I tested the project is the following:</p>",
                                "<p><pre class=\"code-vb\"><span class=\"keyword\">Sub</span> TestProtection()<br><span class=\"function\">Range</span>(<span class=\"string\">\"A1\"</span>).<span class=\"function\">Value</span> = <span class=\"string\">\"Hello World\"</span><br><span class=\"function\">Range</span>(<span class=\"string\">\"B1\"</span>).<span class=\"function\">Value</span> = <span class=\"function\">Int</span>((10 * <span class=\"function\">Rnd</span>) + 1)<br><span class=\"keyword\">End</span> <span class=\"keyword\">Sub</span><br></pre></p>"
                            ]
                        },
                        {
                            "id":"Set Password Protection",
                            "title":"<h3>Set Password Protection</h3>",
                            "body":[
                                "<p>To set the password go to Tools → VBAProject Properties → Protection Tab Set the password as you like and remember to enable &quot;Lock project for viewing&quot;. This option prevents the code from being displayed.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/9d625bae970940b48d5298e6c4e2221a.png\"></p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/64aa7bd0a02343ceb079f66d6fc9cae5.png\"></p>",
                                "<p>In this file, the password set is &quot;test&quot;.</p>"
                            ]
                        },
                        {
                            "id":"Save file",
                            "title":"<h3>Save file</h3>",
                            "body":[
                                "<p>To save the project click on &quot;Save&quot; and choose &quot;No&quot;.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/a43a6fa18bc248e2a21bc64a785f86aa.png\"></p>",
                                "<p>In the new window that will be presented, change the format of the file to be saved to &quot;Excel Macro-Enabled Workbook&quot; and save it.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/6a20d818fca248beac72abe99e9c7b60.png\"></p>",
                                "<p>It will generate a new file containing the source code.</p>"
                            ]
                        },
                        {
                            "id":"Test Password Protection",
                            "title":"<h3>Test Password Protection</h3>",
                            "body":[
                                "<p>To test the password protection open the new file and access the source code, the shorcut is alt+F11 but for some reason is not working for me. Another way to access is navigating to Developer tab and access VisualBasic.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/efa4d62102ca42959f3b55845fb5b77d.png\"></p>",
                                "<p>Trying to access the project containing the source code, you will be asked to enter the previously set password.</p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/d2b595d50c3a49d98d25b5d4f3710e06.png\"></p>"
                            ]
                        }
                    ]
                },
                {
                    "id":"Replace password protection",
                    "title":"<h2><span style=\"color:#da1953\">Rep</span>lace password protection</h2>",
                    "body":[
                        {
                            "id":"Create a dummy project",
                            "title":"<h3>Create a dummy project</h3>",
                            "body":[
                                "<p>In order to access the password-protected source code, we need to create a dummy project with our password and replace the binary dedicated to checking the password on the target file with our own. In words, it might seem difficult but with the example, I am about to show it will be very simple.  Now let's recreate the second file in the same way as seen above but with a different password, let's say that this time the password will be &quot;jafor&quot;. So we have 2 files one with a password set to &quot;test&quot; which is the target file in which we have to bypass the password and the second is our file with a password set to &quot;jafor&quot;. The goal is to replace the password &quot;test&quot; of the first file with the password &quot;jafor&quot;.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/11b19e8cf2624d2f8c16b9134396e097.png\"></p>"
                            ]
                        },
                        {
                            "id":"Exctrat jafor's authentication hex code",
                            "title":"<h3>Exctrat jafor's authentication hex code</h3>",
                            "body":[
                                "<p>To extract the code you need to change the file format from <em>.xlsm</em> to <em>.zip</em>.<p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/fa3bb4f12a974f5a8a80b4992948b541.png\"></p>",
                                "<p>When opening the zip file you will find a folder structure like the following:</p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/cd3dc0fb138e4ccda1c12cef78d7ca41.png\"></p>",
                                "<p>Navigate into the <strong>xl</strong> directory and open <strong>vbaProject.bin</strong> with a hex editor.</p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/735041c734354f049bbf9fc0c079d365.png\"></p>",
                                "<p>The hex-editor used is <a data-from-md title='https://mh-nexus.de/en/hxd/' href='https://mh-nexus.de/en/hxd/'>xhd</a>. Once opened the <em>filevbaProject .bin</em> with the hex-editor, search for the text <em>CMG</em> as seen in the image below.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/c7981a94ce9e4d49bfca963c1c740516.png\"></p>",
                                "<p>Now copy the portion as shown below.</p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/c893006ae98e43f4a07e554a972f4d2f.png\"></p>",
                                "<p>This is the portion of code where it says which password is set, which in this case is &quot;jafor&quot;. Our goal is to replace this portion in the target file so that the password set is &quot;jafor&quot; and no longer &quot;test&quot;.</p>"
                            ]
                        },
                        {
                            "id":"Replace password in the target file",
                            "title":"<h3>Replace password in the target file</h3>",
                            "body":[
                                "<p>We also perform the same steps on the target file to open the binary file with our hex editor and paste the dummy's code in the target file and save it.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/7e876409db514302bd184792b83f7d46.png\"></p>",
                                "<p>After changing the target file's code with our dummy's code:</p>",
                                "<img src=\"/cyber/blog/vbpasswordbypass/a6195e41074b484da3625961a1b1e8d7.png\"></p>",
                                "<p>Replace the modified binary with the original one inside the zip folder and change the format back from <em>.zip</em> to <em>.xlsm</em>. Now we can access the source code with the password &quot;jafor&quot; instead of &quot;test&quot;.</p>",
                                "<p><img src=\"/cyber/blog/vbpasswordbypass/a433c13f02d6453ab41d6a49f87d78d1.png\"></p>"
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
